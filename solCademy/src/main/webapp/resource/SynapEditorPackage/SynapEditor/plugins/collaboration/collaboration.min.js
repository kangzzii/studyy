/*! For license information please see collaboration.min.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1637)}({1016:function(t,e){var n,r,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function c(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var a,l=[],u=!1,h=-1;function d(){u&&a&&(u=!1,a.length?l=a.concat(l):h=-1,l.length&&f())}function f(){if(!u){var t=c(d);u=!0;for(var e=l.length;e;){for(a=l,l=[];++h<e;)a&&a[h].run();h=-1,e=l.length}a=null,u=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function _(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new _(t,e)),1!==l.length||u||c(f)},_.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},1017:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="";r=n?'<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="8" cy="8" r="7" fill="'+e+'" stroke="#39B6B8" stroke-width="2"/><text alignment-baseline="middle" text-anchor="middle" style="font-size: 8px; font-weight: bold; text-align: center;" x="8" y="9" fill="#000000">'+t.toString()[0]+"</text></svg>":'<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="8" cy="8" r="8" fill="'+e+'"/><text alignment-baseline="middle" text-anchor="middle" style="font-size: 8px; font-weight: bold; text-align: center;" x="8" y="9" fill="#000000">'+t.toString()[0]+"</text></svg>";return r}},1018:function(t,e,n){"use strict";e.__esModule=!0,e.getPanelContentHTML=function(t){return'<button type="button" class="se-panel-btn-wrapper se-single-btn se-clickable se-disable" aria-label="'+r.BUTTON_NAME.COLLABORATOR+'" aria-haspopup="true" '+(t?'style="min-width: '+((t+5)*r.ICON_COUNT+34)+'px"':"")+'>\n            <div class="se-panel-btn" value="main"></div>\n            <div class="se-panel-btn" value="sub">\n                <span class="se-user-count"></span>\n                <span class="se-arrow se-rotate-180"></span>\n            </div>\n        </button>\n        <div class="se-panel-menu-wrapper"></div>\n    '},e.getHistoryDialogHTML=function(){return"<div class='se-version-list'></div><div class='se-history-preview se-component-border'></div>"};var r=n(441)},1019:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));n(3);var r=n(8);const i=(t,e,n)=>{switch(r.k(t)){case 0:n(e,r.j(t))}}},1020:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(278);const i=t=>r.g(t,(t,e)=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`).join("&")},12:function(t,e,n){"use strict";function r(t){var e=(t||navigator.userAgent).toLowerCase(),n={};return n.isMSEdge=/edge/i.test(e),n.isIE11=/trident\/7/i.test(e),n.isIE10=/msie 10/i.test(e),n.isIE9=/msie 9/i.test(e),n.isIE8=/msie 8/i.test(e),n.isChrome=/chrome/i.test(e)&&!n.isMSEdge,n.isFirefox=/firefox/i.test(e)&&!n.isMSEdge,n.isSafari=/safari/i.test(e)&&!n.isMSEdge&&!n.isChrome,n.isOpera=/opera/i.test(e)&&!n.isMSEdge,n.isWindows=/windows/i.test(e),n.isAndroid=/android/i.test(e),n.isLinux=/linux/i.test(e)&&!n.isAndroid,n.isUnix=/x11/i.test(e)&&!n.isLinux,n.isIOS=/iphone|ipad|ipod/i.test(e)||/mac/i.test(e)&&"ontouchend"in document,n.isMac=/mac/i.test(e)&&!n.isIOS,n.IOSVersion=n.isIOS?function(t){var e=t.match(/os (x )?\d+/i)[0].split(" ");return parseInt(e.pop())||-1}(e):-1,n}e.__esModule=!0,e.getStatus=r;var i=r(),s=(e.isMSEdge=i.isMSEdge,e.isIE11=i.isIE11),o=e.isIE10=i.isIE10,c=e.isIE9=i.isIE9,a=e.isIE8=i.isIE8,l=(e.isMSIE=s||o||c||a,e.isFirefox=i.isFirefox,e.isSafari=i.isSafari,e.isOpera=i.isOpera,e.isChrome=i.isChrome,e.isWindows=i.isWindows,e.isAndroid=i.isAndroid),u=(e.isLinux=i.isLinux,e.isUnix=i.isUnix,e.isIOS=i.isIOS);e.isMac=i.isMac,e.isMobile=l||u,e.IOSVersion=i.IOSVersion},1637:function(t,e,n){t.exports=n(1638)},1638:function(t,e,n){"use strict";var r=n(441);n(1639);var i=h(n(1640)),s=h(n(1643)),o=h(n(1645)),c=h(n(89)),a=n(1646),l=n(12),u=h(n(1647));function h(t){return t&&t.__esModule?t:{default:t}}window.SynapEditor?((0,c.default)(o.default),window.SynapEditor.addPlugin(r.PLUGIN_NAME,(function(t){if(!(t.getConfiguration(r.PLUGIN_NAME+".config")||{}).wsUrl||l.isMSIE)return{};var e=new i.default(t),n=new s.default(t,e);return t.util.isDevMode()&&!window.collaboManager&&(window.collaboManager=e),{dialogs:[(0,a.createHistoryDialog)(t,e)],buttonDef:(0,u.default)(t,n),EVENT_TYPE:r.EVENT_TYPE,init:function(){e.init()},on:function(t,n){e.on(t,n)},off:function(t,n){e.off(t,n)},setUserName:function(t){e.setUser({name:t},!0)},setUserColor:function(t){e.setUser({color:t},!0)},setUserData:function(t){e.setUser({data:t},!0)},getClientId:function(){return e.getClientId()},changeDocument:function(t){e.changeDocument(t)},destroy:function(){e.destroy()},setInit:function(t){e.setInit(t)},getServerInfo:function(){return e.getServerInfo()},getHistory:function(){return e.getHistory()},applyChanges:function(){e.applyChanges()}}}))):r.PLUGIN_NAME},1639:function(t,e,n){},1640:function(t,e,n){"use strict";e.__esModule=!0;var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(417)),s=n(441),o=l(n(785)),c=n(1641),a=l(n(1642));function l(t){return t&&t.__esModule?t:{default:t}}var u=["#397BB8","#3C39B8","#9739B8","#B83985","#B83939","#39B855","#A6B839","#B88539","#B85739","#39B6B8"],h=["Happy","Sad","Angry","Excited","Scared","Hungry","Surprised","Tired","Bored","Calm"],d=["Cat","Dog","Rabbit","Hamster","Donkey","Turtle","Bird","Snake","Lizard","Horse"],f=new Set(["style","body"]),_=function(){function t(e){var n,r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=e,this.util=this.editor.util,this.configuration=this.editor.getConfiguration(s.PLUGIN_NAME+".config")||{},this.SEModelManager=this.editor.getSEModelManager(),this.formulaManager=this.editor.getFormulaManager(),this.windowEventManager=this.editor.getWindowEventManager(),this.renderManager=this.editor.getRenderManager(),this.shapeManager=this.editor.getShapeManager(),this.positionManager=this.editor.getPositionManager(),this.selectionManager=this.editor.getSelectionManager(),this.selectionRenderer=this.editor.getSelectionRenderer(),this.jsonStringBuilder=this.editor.getJsonStringBuilder(),this.modelHandler=this.editor.getModelHandler(),this.uiManager=this.editor.getUIManager(),this.controller=this.editor.getController(),this.yDoc=null,this.provider=null,this.awareness=null,this.__subProvider__=null,this.yUndoManager=null,this.isSynced=!1,this.isLoaded=!1,this.loadingIntervalId=0,this.beforeBody=null,this.transactInfo={},this.user={},this.removedUserIds=new Set;var i=this.editor.constructor.CONST.CUSTOM_EVENT_TYPE;this.__originAction__={},this.__originUIStatus__={},this.__editorEventMap__=((n={})[i.AFTER_EDIT]=this.__afterEdit__.bind(this),n[i.AFTER_OPEN_DOCUMENT]=this.__afterEdit__.bind(this),n[i.ON_SELECTION]=this.__onSelection__.bind(this),n[i.MODE_CHANGED]=this.__modeChanged__.bind(this),n[i.BEFORE_RELOAD]=this.__beforeReload__.bind(this),n),this.__eventListenerMap__={},this.__yEvents__=[],this.__changesBuffer__=[];var o=this.configuration,c=o.wsUrl,a=o.docId,l=o.useHistory;this.__wsUrl__=c,this.__docId__=a,this.__useHistory__=l,this.__snapshotHistory__=null;var u=this.editor.constructor.CONST.ELEMENT_TYPE;this.PARA_RENDERING_ELEMENTS=new Set([u.TABLE,u.TABLE_ROW,u.TABLE_CELL,u.DIV]),this.SPLIT_CHUNK_SIZE=this.util.isNumber(this.configuration.splitSize)&&0!==this.configuration.splitSize?this.configuration.splitSize:s.DEFAULT_SPLIT_CHUNK_SIZE,this.EDIT_SYNC_INTERVAL=this.util.isNumber(this.configuration.editSyncInterval)?this.configuration.editSyncInterval:s.DEFAULT_EDIT_SYNC_INTERVAL,this.__latestUserIdSet__=new Set,this.__awarenessWorker__=null,this.__updatedModels__=[],this.__intervalId__=0,this.__addHistoryDebounced__=this.util.debounce((function(){return r.__addHistory__.apply(r,arguments)}),s.DEFAULT_HISTORY_DEBOUNCE_TIME),this.__applyChangesBufferThrottled__=this.util.throttle((function(){return r.__applyChangesBuffer__()}),this.EDIT_SYNC_INTERVAL)}return t.prototype.init=function(){var t=this;if(!this.__docId__)throw new Error("[CollaboManager] No docId is set.");setTimeout((function(){t.isLoaded||t.editor.showLoadingProgress(t.editor.getMessage(o.default.SYNC_DOCUMENT)),t.loadingIntervalId=setInterval((function(){t.isLoaded&&(clearInterval(t.loadingIntervalId),t.editor.hideLoadingProgress())}),250),setTimeout((function(){return t.__loadCompleted__()}),6e4)}),500),this.__init__();var e=this.configuration,n=e.userName,r=e.userColor,i=e.userData,s=e.defaultNames,c=e.defaultColors,a=function(t){return parseInt(Math.random()*t,10)},l=void 0,f=void 0;l=s?s[a(s.length)]:h[a(h.length)]+" "+d[a(d.length)],f=c?c[a(c.length)]:u[a(u.length)],this.setUser({id:this.getClientId(),name:n||l,color:r||f,data:i||null}),this.util.isFunction(this.fnInit)&&this.fnInit(this.user)},t.prototype.__init__=function(){this.destroy(),this.__initInterval__(),this.__attachEvent__(),this.__initEditorUIStatus__(),this.__initEditorActions__(),this.__initYDocument__()},t.prototype.__loadCompleted__=function(){this.isLoaded=!0},t.prototype.__initYDocument__=function(){this.yDoc=new i.Doc,this.provider=new c.WebsocketProvider(this.__wsUrl__,this.__docId__,this.yDoc),this.provider.on("sync",this.__onSync__.bind(this)),this.awareness=this.provider.awareness,this.awareness.on("change",this.__onChangeUser__.bind(this)),this.__getRoot__().observeDeep(this.__handleConnectionStateChange__.bind(this))},t.prototype.__initInitialData__=function(){var t=this.__getRoot__();t.set(s.TYPE.IS_ALONE,!0),t.set(s.TYPE.LAST_USER_ID,this.getClientId())},t.prototype.__applySEModelToSubDoc__=function(t){var e=this,n=this.jsonStringBuilder.toJSON(this.__getSEModelJSON__());Object.entries(n).forEach((function(n){var r=n[0],i=n[1];return t.getMap().set(r,e.__buildYModel__(i))}))},t.prototype.__createSubDoc__=function(){var t=this,e=new i.Doc;this.__applySEModelToSubDoc__(e),this.__getRoot__().set(s.TYPE.SUB,e),e.getMap().observeDeep((function(){return t.__observeYModel__.apply(t,arguments)}))},t.prototype.__initSubDoc__=function(){var t=this;this.__initSubDocProvider__();var e=this.getSubDoc();e.load(),e.getMap().observeDeep((function(){return t.__observeYModel__.apply(t,arguments)}))},t.prototype.__initSubDocProvider__=function(){var t=this;this.__destroySubDocProvider__(),this.__subProvider__=new c.WebsocketProvider(this.__wsUrl__,s.SUB_DOC_PREFIX+this.__docId__,this.getSubDoc()),this.__subProvider__.on("connection-close",this.__onSubDocClose__.bind(this)),this.__subProvider__.on("sync",(function(e){var n=t.getSubDoc();e&&t.util.isEmpty(n.getMap().toJSON())&&n.transact((function(){return t.__applySEModelToSubDoc__(n)}))}));var e=this.__subProvider__.awareness;e.setLocalState(e.getLocalState())},t.prototype.__destroySubDocProvider__=function(){this.__subProvider__&&(this.__subProvider__.destroy(),this.__subProvider__=null)},t.prototype.__initAwarenessWorker__=function(){var t=this;this.__destroyAwarenessWorker__();var e="let id;self.onmessage=(e)=>{const d=e.data;if(d==='"+s.AWARENESS_WORKER_DATA.START+"'){clearInterval(id);id=setInterval(()=>{postMessage('"+s.AWARENESS_WORKER_DATA.PING+"')},"+s.AWARENESS_PING_INTERVAL+")}}",n=new Blob([e],{type:"application/javascript; charset=utf-8"}),r=window.URL.createObjectURL(n);this.__awarenessWorker__=new Worker(r),this.__awarenessWorker__.onmessage=function(e){var n=e.data;if(t.awareness&&n===s.AWARENESS_WORKER_DATA.PING&&(t.awareness.setLocalState(t.awareness.getLocalState()),t.__subProvider__)){var r=t.__subProvider__.awareness;r.setLocalState(r.getLocalState())}},this.__awarenessWorker__.postMessage(s.AWARENESS_WORKER_DATA.START)},t.prototype.__addUpdatedModels__=function(t){this.__updatedModels__.push({modified:Date.now(),models:t})},t.prototype.__deleteUpdatedModels__=function(){var t=Date.now()-1e3,e=this.__updatedModels__.findIndex((function(e){return e.modified>t})),n=e<0?this.__updatedModels__.length:e+1;this.__updatedModels__.splice(0,n)},t.prototype.__getUpdatedModels__=function(){return this.__updatedModels__.reduce((function(t,e){var n=e.models;return t.push.apply(t,n),t}),[])},t.prototype.getConflictedModels=function(){return this.__deleteUpdatedModels__(),this.__getUpdatedModels__()},t.prototype.changeDocument=function(t){if(!t)throw this.__triggerEvent__(s.EVENT_TYPE.ON_CLOSE),new Error("[CollaboManager] No docId is set.");this.__docId__=t,this.provider?(this.__init__(),this.setUser({id:this.getClientId()})):this.init()},t.prototype.destroy=function(){this.__triggerEvent__(s.EVENT_TYPE.ON_CLOSE),this.__destroyProvider__(),this.__destroyAwarenessWorker__(),this.__destroySubDocProvider__()},t.prototype.setInit=function(t){this.fnInit=t},t.prototype.setUser=function(t){var e=t.id,n=t.name,i=t.color,s=t.data,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=!(!(e||n||i)&&this.editor.util.isEmpty(s));if(e&&(this.user.id=e),n&&(this.user.name=n),i&&(this.user.color=i),this.editor.util.isEmpty(s)||(this.user.data=this.editor.util.cloneDeep(s)),o&&c){var a=this.awareness.getLocalState(),l=a.user;this.__setUserInfo__(r({},l,this.user))}},t.prototype.getUsers=function(){var t=this;return this.awareness?Array.from(this.awareness.getStates().values()).reduce((function(e,n){var r=n.user;return r&&e.push({id:r.id,name:r.name||"",color:r.color,data:r.data||null,position:r.position,modified:r.modified,self:r.id===t.yDoc.clientID}),e}),[]):[]},t.prototype.getClientId=function(){return this.yDoc?this.yDoc.clientID:-1},t.prototype.__startInterval__=function(t,e){this.__initInterval__(),t(),this.__intervalId__=window.setInterval(t,e)},t.prototype.__initInterval__=function(){window.clearInterval(this.__intervalId__)},t.prototype.__getTransactInfo__=function(){return this.transactInfo},t.prototype.__setTransactInfo__=function(t,e){this.transactInfo={id:t,beforeSelection:e}},t.prototype.__getChangesBuffer__=function(){return this.__changesBuffer__},t.prototype.__addToChangesBuffer__=function(t){this.__changesBuffer__.push(t)},t.prototype.__clearChangesBuffer__=function(){this.__changesBuffer__=[]},t.prototype.__applyChangesBuffer__=function(){var t=this,e=this.__getChangesBuffer__();if(!this.util.isEmpty(e)){var n=this.util.get(e,[0,"beforeSelection"]),r=Array.from(e.reduce((function(e,n){return t.util.isArray(n.targetIds)&&n.targetIds.forEach((function(t){return e.add(t)})),e}),new Set));this.__applyChangesToYModel__(n,r),this.__clearChangesBuffer__()}},t.prototype.__destroyProvider__=function(){this.provider&&(this.provider.destroy(),this.provider=null,this.__detachEvent__(),this.__restoreEditorUIStatus__(),this.__restoreEditorAction__())},t.prototype.__destroyAwarenessWorker__=function(){this.__awarenessWorker__&&(this.__awarenessWorker__.terminate(),this.__awarenessWorker__=null)},t.prototype.__createDocument__=function(t){return this.SEModelManager.createDocument(t)},t.prototype.__triggerEvent__=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=this.__eventListenerMap__[t];i&&Array.from(i).forEach((function(t){t.apply(void 0,n)}))},t.prototype.__attachEvent__=function(){var t=this.editor.getCustomEventManager();Object.entries(this.__editorEventMap__).forEach((function(e){var n=e[0],r=e[1];return t.add(n,r)}))},t.prototype.__detachEvent__=function(){var t=this.editor.getCustomEventManager();Object.entries(this.__editorEventMap__).forEach((function(e){var n=e[0],r=e[1];return t.remove(n,r)}))},t.prototype.__isInitialized__=function(){return this.__getRoot__().has(s.TYPE.IS_ALONE)&&this.awareness.getStates().size>1},t.prototype.__onSync__=function(t){var e=this,n=!1;if(this.isSynced=t,t){var r={__forceUpdate__:!1,get forceUpdate(){return this.__forceUpdate__},setForceUpdate:function(t){this.__forceUpdate__=t},isSynced:this.isSynced};this.__triggerEvent__(s.EVENT_TYPE.ON_SYNC,r),!this.__isInitialized__()||r.forceUpdate?(n=!0,this.__initInitialData__(),this.__createSubDoc__(),this.__loadCompleted__()):this.__initSubDoc__(),this.__initHistory__(),this.__initUndoManager__(),this.__initAwarenessWorker__(),this.__updateUserInfo__()}this.isSynced&&!n&&(this.__yEvents__.forEach((function(t){return e.__observeYModel__(t)})),this.__yEvents__=[])},t.prototype.__onSubDocClose__=function(t){var e=this;if(1009===t.code){this.__destroyProvider__();this.__startInterval__((function(){var t=e.editor.getMessage(o.default.NOTIFICATION_MAX_PAYLOAD),n=e.editor.constructor.CONST.NOTIFICATION_LEVEL;e.editor.getUIManager().showNotification(t,n.ERROR)}),3e3)}this.__triggerEvent__(s.EVENT_TYPE.ON_CLOSE)},t.prototype.__initUndoManager__=function(){this.yUndoManager=new i.UndoManager(this.__getSubRoot__(),{captureTimeout:0,trackedOrigins:new Set([this.getClientId()])}),this.yUndoManager.on("stack-item-added",this.__onStackItemAdded__.bind(this)),this.yUndoManager.on("stack-item-popped",this.__onStackItemPopped__.bind(this))},t.prototype.__initEditorActions__=function(){var t=this,e=this.editor.constructor.ACTION;this.__setOriginAction__(e.UNDO,this.controller.getClass(e.UNDO)),this.editor.addCommand(e.UNDO,{isExecutableOn:function(){return!0},execute:function(){t.undo()},options:{undoredo:!1}},!0),this.__setOriginAction__(e.REDO,this.controller.getClass(e.REDO)),this.editor.addCommand(e.REDO,{isExecutableOn:function(){return!0},execute:function(){t.redo()},options:{undoredo:!1}},!0)},t.prototype.__initEditorUIStatus__=function(){var t=this,e=this.editor.constructor.CONST,n=e.UI_NAME,r=e.UI_STATUS,i=this.uiManager.getComponentStatus(n.SOURCE);this.__setOriginUIStatus__(n.SOURCE,i);var s=this.util.merge({},i,{fn:function(){return{status:r.DISABLE}}});this.uiManager.addToComponentStatusMap(n.SOURCE,s,!0),this.uiManager.updateComponentStatus(n.SOURCE);var o=this.uiManager.getComponentStatus(n.UNDO);this.__setOriginUIStatus__(n.UNDO,o);var c=this.util.merge({},o,{fn:function(){return{status:t.yUndoManager&&t.yUndoManager.canUndo()?null:r.DISABLE}}}),a=this.uiManager.getComponentStatus(n.REDO);this.__setOriginUIStatus__(n.REDO,a);var l=this.util.merge({},a,{fn:function(){return{status:t.yUndoManager&&t.yUndoManager.canRedo()?null:r.DISABLE}}});this.uiManager.addToComponentStatusMap(n.UNDO,c,!0),this.uiManager.addToComponentStatusMap(n.REDO,l,!0),this.__clearUndoRedo__()},t.prototype.__setOriginAction__=function(t,e){!(t in this.__originAction__)&&e&&(this.__originAction__[t]=e)},t.prototype.__setOriginUIStatus__=function(t,e){t in this.__originUIStatus__||(this.__originUIStatus__[t]=e||{})},t.prototype.__restoreEditorAction__=function(){var t=this;Object.entries(this.__originAction__).forEach((function(e){var n=e[0],r=e[1];t.controller.setClass(n,r)}))},t.prototype.__restoreEditorUIStatus__=function(){var t=this;Object.entries(this.__originUIStatus__).forEach((function(e){var n=e[0],r=e[1];t.uiManager.addToComponentStatusMap(n,r,!0),t.uiManager.updateComponentStatus(n)})),this.editor.getUndoRedo().init()},t.prototype.__updateBeforeBody__=function(){this.beforeBody=this.__getYModel__([]).toJSON()},t.prototype.__updateUndoRedoUIStatus__=function(){var t=this.editor.constructor.CONST.UI_NAME;this.uiManager.updateComponentStatus(t.UNDO),this.uiManager.updateComponentStatus(t.REDO)},t.prototype.__clearUndoRedo__=function(){this.yUndoManager&&this.yUndoManager.clear(),this.__updateUndoRedoUIStatus__()},t.prototype.__isUndoRedoStackClearAction__=function(t){var e=this.editor.constructor.ACTION;return new Set([e.NEW_DOCUMENT,e.OPEN_DOCUMENT,e.OPEN_HTML]).has(t)},t.prototype.__onStackItemAdded__=function(t,e){var n=t.type,r=t.stackItem,i=e.undoing,s=e.redoing,o=this.__getTransactInfo__(),c=o.id,a=o.beforeSelection;"undo"!==n||i||s||(r.meta.set("id",c),r.meta.set("beforeSelection",a),r.meta.set("afterSelection",this.selectionManager.selection.clone())),this.__updateUndoRedoUIStatus__()},t.prototype.__onStackItemPopped__=function(t,e){var n=t.type,r=t.stackItem,i=e.undoing,s=e.redoing,o=e.undoStack,c=e.redoStack,a=r.meta.get("id"),l=r.meta.get("beforeSelection"),u=r.meta.get("afterSelection"),h=null,d=!0;if("undo"===n&&i){var f=this.util.last(c);f.meta.set("id",a),f.meta.set("beforeSelection",l),f.meta.set("afterSelection",u),h=l,this.util.isEmpty(o)||this.util.last(o).meta.get("id")!==a||(d=!1,this.yUndoManager.undo())}else if("redo"===n&&s){var _=this.util.last(o);_.meta.set("id",a),_.meta.set("beforeSelection",l),_.meta.set("afterSelection",u),h=u,this.util.isEmpty(c)||this.util.last(c).meta.get("id")!==a||(d=!1,this.yUndoManager.redo())}d&&(h&&this.__applySelection___(h),this.__updateUndoRedoUIStatus__())},t.prototype.__applySelection___=function(t){if(t.isTextSelection()){var e=t.anchor,n=t.focus;this.selectionManager.selection.set(e,n)}else t.isDrawingObjectSelection()&&this.selectionManager.setMultiSelection(t.getDrawingObjectIds());this.selectionRenderer.renderSelection(this.selectionManager.selection),this.__updateUserInfo__()},t.prototype.__afterEdit__=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.provider&&this.provider.wsconnected){var n=this.editor.constructor.ACTION,r=e.actionName;if(r!==n.UNDO&&r!==n.REDO){this.__addToChangesBuffer__(e);var i=e.beforeSelection;if([n.INSERT_TEXT,n.DELETE_LEFT,n.DELETE_RIGHT,n.INSERT_EMOJI].some((function(t){return t===r}))){var s=this.getConflictedModels(),c=s.some((function(e){var n=t.SEModelManager.getElement(i.focus.id);return n&&(n.contains(e)||e.contains(n))}));if(c){var a=this.editor.constructor.CONST.NOTIFICATION_LEVEL;this.uiManager.showNotification(this.editor.getMessage(o.default.NOTIFICATION_CONFLICT),a.WARNING)}}this.__applyChangesBufferThrottled__(),this.__isUndoRedoStackClearAction__(r)&&this.__clearUndoRedo__()}}},t.prototype.__onSelection__=function(){this.__updateUserInfo__()},t.prototype.__modeChanged__=function(){this.editor.isEditMode()&&this.__renderRemoteSelections__()},t.prototype.__beforeReload__=function(t){var e=this.jsonStringBuilder.buildJSON(this.__getYModel__([]).toJSON())[0];t.setSEModel(this.__createDocument__(e))},t.prototype.__setUserInfo__=function(t){var e=this.selectionManager.selection.focus;this.awareness.setLocalStateField("user",r({},t,{position:e,modified:Date.now()}))},t.prototype.__updateUserInfo__=function(){this.__setUserInfo__(r({},this.user))},t.prototype.__onChangeUser__=function(t){var e=this,n=t.added,r=t.removed,i=r.filter((function(t){return t!==e.getClientId()}));try{this.__renderRemoteSelections__(i)}catch(t){}finally{if(!this.provider)return;var o=this.getUsers(),c=new Set(o.map((function(t){return t.id})));(!this.util.isEqual(c,this.__latestUserIdSet__)||n.length>0||r.length>0)&&this.__triggerEvent__(s.EVENT_TYPE.USER_CHANGED,o,n,r),this.__triggerEvent__(s.EVENT_TYPE.USER_INFO_CHANGED,o,n,r),this.__latestUserIdSet__=c}},t.prototype.__isYBuildTarget__=function(t){return this.util.isArray(t)||this.util.isObject(t)},t.prototype.__handleConnectionStateChange__=function(t){if(t.some((function(t){var e=t.keysChanged;return e&&e.has(s.TYPE.IS_ALONE)}))){var e=this.__getIsAlone__(),n=this.__getLastUserId__()===this.getClientId();e?this.__destroySubDocProvider__():n&&this.__initSubDocProvider__()}},t.prototype.__applyChangesToYModel__=function(t,e){var n=this;this.__updateBeforeBody__();var i=this.__diff__(e);if(!this.util.isEmpty(i)){var o=this.util.chunk(i,this.SPLIT_CHUNK_SIZE),c=this.util.uuid();this.__setTransactInfo__(c,t),o.forEach((function(t,e){n.getSubDoc().transact((function(){0===e&&n.__getSubRoot__(s.SUBDOC_ROOT_NAME.META).set(s.SUBDOC_META_TYPE.USER,n.user),t.forEach((function(t){var e=t;if("A"===t.kind){var i=n.util.get(t,["item"])||{};e=r({},t,i)}n.__applyYModel__(e)}))}),n.getClientId())})),this.__updateUserInfo__(),this.__renderRemoteSelections__()}},t.prototype.__diff__=function(t){var e=this;try{if(!t||this.util.isEmpty(t))throw new Error(s.DIFF_ERROR_MESSAGE.NO_TARGET_IDS);for(var n=t.map((function(t){var n=e.SEModelManager.getElement(t);if(n)return n;throw new Error(s.DIFF_ERROR_MESSAGE.HAS_DELETED_MODEL)})),r=n[0],i=1;i<n.length;i++)if(r=r.closestCommonAncestorOf(n[i],!0),this.util.isBody(r))throw new Error(s.DIFF_ERROR_MESSAGE.CCA_IS_BODY);var o=r.getPath(),c=o.reduce((function(t,e){return t[e]}),this.beforeBody);if(c&&g(c)===r.getId())return this.util.diff(c,this.jsonStringBuilder.toJSON(r),{basePath:o});throw new Error(c?s.DIFF_ERROR_MESSAGE.MODEL_PATH_CHANGED:s.DIFF_ERROR_MESSAGE.BACKUP_NOT_FOUND)}catch(t){return this.util.diff(this.beforeBody,this.__getSEModelJSON__().body)}},t.prototype.__getModifiedYModelFromEvents__=function(t){var e=this,n=[],r=new Set,s=new Set,o=!1,c=!1,a=function(t,e,s){for(var o=t.parent,c=!1;o;){if(o instanceof i.Map&&g(o)&&r.has(o)){c=!0;break}o=o.parent}c||r.has(t)||(n.push({yModel:t,path:e,keysChanged:s}),r.add(t))};return t.forEach((function(t){var n=t.target,r=t.path,l=t.transaction,u=t.keysChanged;if(!(l.local&&(c=!0,l.origin===e.getClientId())||o)){var h=e.__getSubRoot__();if(n===h||n===h.get("body")&&u&&u.has("id"))o=!0;else if(n instanceof i.Text)a(n.parent,r.slice(1,-1),u);else if(n instanceof i.Array){var d=n.parent,f=g(d),_=e.SEModelManager.getElement(f);if(_){var p=e.util.last(r),y=n.toJSON();if("children"===p){var w=_.getChildren();w.forEach((function(t,i){var o=y.findIndex((function(n){return e.jsonStringBuilder.isModelJSON(n)&&g(t)===g(n)&&t.type===n.type}));if(o>-1){var c=e.util.isEqual(e.jsonStringBuilder.toJSON(t),y[o]),l=n.get(o),h=[].concat(r.slice(1),[o]);if(i===o)!c&&a(l,h,u);else{var d=w[Math.max(0,i-1)],f=y[Math.max(0,o-1)];g(d)!==g(f)||d.type!==f.type?(s.add(t),a(l,h,u)):c||a(l,h,u)}}else s.add(t)}))}else a(d,r.slice(1,-1),u);y.forEach((function(t,i){e.jsonStringBuilder.isModelJSON(t)&&!_.children.find((function(e){return g(e)===g(t)&&e.type===t.type}))&&a(n.get(i),[].concat(r.slice(1),[i]),u)}))}}else if(n instanceof i.Map){for(var m=n,E=r.slice(1);m&&!e.jsonStringBuilder.isModelType(m.get("type"));)m=m.parent,E.pop();m&&e.jsonStringBuilder.isModelType(m.get("type"))&&a(m,E,u)}}})),{self:c,rootModified:o,targetYModels:n,deletedModels:Array.from(s)}},t.prototype.__getModel__=function(t){var e=this.SEModelManager.getBody();return t.reduce((function(t,e){return t[e]}),e)},t.prototype.__getSEModelJSON__=function(){return this.jsonStringBuilder.toJSON(this.SEModelManager.getSEModel())},t.prototype.__getElement__=function(t,e){var n=void 0,r=this.editor.constructor.CONST.ELEMENT_TYPE;if(e===r.HYPERLINK_START)n=(this.SEModelManager.getHyperlink(t)||{}).hyperlinkStart;else if(e===r.HYPERLINK_END){n=(this.SEModelManager.getHyperlink(t)||{}).hyperlinkEnd}else n=this.SEModelManager.getElement(t);return n},t.prototype.__applyModel__=function(t,e,n){var r=this;if(t){var i=this.__getSubRoot__().toJSON(),s=this.jsonStringBuilder.buildJSON(i.body)[0];return this.formulaManager.init(),this.modelHandler.initRenderTargetElements(),s.children&&this.SEModelManager.setSEModel(this.__createDocument__(s)),this.shapeManager&&this.SEModelManager.getShapes().forEach((function(t){return r.__applyShape__(t)})),{bodyUpdated:!0,updatedBodyProps:[],renderTargets:[]}}var o=this.editor.constructor.CONST.ELEMENT_TYPE,c=this.SEModelManager.getBody().createTempIndexManager(),a=new Set,l=!1,u=[],h=function(t,e){r.__getRenderTargets__(t,e).forEach((function(t){return a.add(t)}))};n.forEach((function(t){h(t),t.remove()}));for(var d=0,f=e.length;d<f;d++){var _=e[d],p=_.yModel,y=_.path,w=_.keysChanged,m=this.jsonStringBuilder.buildJSON(p.toJSON(),{newId:!1})[0],E=g(p),b=p.get("type"),S=this.__getElement__(E,b);if(b===o.BODY){if(!S||S.getId()!==m.getId()){l=!0;break}u.push.apply(u,this.__applyBodyModel__(S,m))}else{if(S){var v=S.getPath();if(this.util.isEqual(y,v)){S.replaceWith(m),h(m,w);continue}var M=this.__getYModel__(v);g(M)===S.getId()&&M.parent.delete(this.util.last(v),1),h(S,w),S.remove()}var k=!!w&&(w.has("id")||w.has("type")),I=this.__getModel__(y);if(k&&I)h(I,w),I.replaceWith(m);else{for(var A=p.parent,C=void 0,T=this.util.last(y)+1;T<A.length;T++){var D=A.get(T);if(C=this.__getElement__(g(D),D.get("type")))break}if(C)h(C,w),C.before(m);else{var O=this.__getModel__(y.slice(0,-2));O.append(m),this.util.isBody(O)||h(O)}}h(m,w)}}return this.SEModelManager.getShapes(c).forEach((function(t){return r.__applyShape__(t)})),this.SEModelManager.getBody().emptyRevivedElements(),this.SEModelManager.getBody().removeTempIndexManager(),{bodyUpdated:l,updatedBodyProps:u,renderTargets:this.__filterRedundantModels__(this.__sortRenderTargets__(Array.from(a)))}},t.prototype.__applyBodyModel__=function(t,e){var n=this,r=[];return Object.keys(t).filter((function(t){return!n.util.startsWith(t,"__")&&"children"!==t})).forEach((function(i){var s=e.getProperty(i);n.util.isEqual(t.getProperty(i),s)||(t.setProperty(i,s),r.push(i))})),r},t.prototype.__applyShape__=function(t){if(this.shapeManager&&!t.isCustom()){var e=t.getId(),n=t.getBase();!!this.shapeManager.getShape(e)?this.shapeManager.changeShapeAttribute(e,this.shapeManager.objToChangeAttr(n)):this.shapeManager.registerByObject(n,e)}},t.prototype.__getRenderTargets__=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set,r=[];if(t){var i=this.editor.constructor.CONST.ELEMENT_TYPE,s=t.getType();if(this.PARA_RENDERING_ELEMENTS.has(s)||s===i.IMAGE&&n.has("hyperlink")||n.has("relativeFrom")||0===n.size&&t.getProperty("relativeFrom")){var o=t.closest((function(t){return e.util.isParagraph(t)}));o&&r.push(o)}else if(s===i.LIST_ITEM&&n.has("level")){var c=t.parent();c&&r.push(c)}else s!==i.HYPERLINK_START&&s!==i.HYPERLINK_END||r.push.apply(r,this.__getParagraphsBetweenHyperlink__(t.getId()));r.push(t)}return r},t.prototype.__sortRenderTargets__=function(t){var e=this;return t.sort((function(t,n){for(var r=t.getPath(),i=n.getPath(),s=1;s<r.length;s+=2){var o=r[s],c=i[s];if(e.util.isNil(o)||e.util.isNil(c)||o!==c)return e.util.isNil(c)||o>=c?1:-1}return-1}))},t.prototype.__isPathBigger__=function(t,e){var n=this,r=this.util.pick(t,p(t));return Object.entries(r).every((function(r){var i=r[0],s=r[1];return t.length<=e.length&&(e[i]>=s||n.util.isNil(e[i]))}))},t.prototype.__isPathSmaller__=function(t,e){var n=this,r=this.util.pick(t,p(t));return Object.entries(r).every((function(r){var i=r[0],s=r[1];return t.length>=e.length&&(e[i]<=s||n.util.isNil(e[i]))}))},t.prototype.__filterRedundantModels__=function(t){var e=[];if(!this.util.isEmpty(t)){var n=t[0],r=n.getPath();e.push(n);for(var i=1,s=t.length;i<s;i++){var o=t[i],c=o.getPath();(this.util.isEmpty(r)||r.length>=c.length||this.util.last(r)!==c[r.length-1])&&(e.push(o),n=o,r=c)}}return e},t.prototype.__getParagraphsBetweenHyperlink__=function(t){var e=this,n=new Set,r=this.SEModelManager.getHyperlink(t);return r&&function(){for(var t=r.hyperlinkStart,i=r.hyperlinkEnd,s=t.getPath().slice(0,-2),o=i.getPath().slice(0,-2),c=s.findIndex((function(t,e){return t!==o[e]})),a=s.slice();;){var l=e.__getModel__(a);if(l&&(e.util.isParagraph(l)&&n.add(l),l.findAll(e.util.isParagraph).forEach((function(t){e.__isPathSmaller__(o,t.getPath())&&n.add(t)}))),c<0||a[c]+1>o[c])break;if(a.length<=o.length)(a=a.slice(0,c+1))[c]+=1;else{for(var u=l.parent(),h=c;h>=0;h--)u.findAll(e.util.isParagraph).forEach((function(t){e.__isPathBigger__(s,t.getPath())&&n.add(t)})),u=u.parent();(a=a.slice(0,o.length))[c]+=1}}}(),Array.from(n)},t.prototype.__applyYModel__=function(t){switch(t.kind){case"N":this.__addYModel__(t);break;case"D":this.__deleteYModel__(t);break;case"E":this.__updateYModel__(t)}},t.prototype.__observeYModel__=function(t){if(this.isSynced){var e=this.editor.constructor.ACTION;this.editor.execCommand(e.SET_CONTENTS_SCROLL_EVENT,!1);var n=this.__getModifiedYModelFromEvents__(t),i=n.self,o=n.rootModified,c=n.targetYModels,a=n.deletedModels,l=this.util.cloneDeep(i?this.user:this.__getUserMeta__());this.__addHistoryDebounced__(l,o);var u=this.__applyModel__(o,c,a),h=u.bodyUpdated,d=u.updatedBodyProps,f=u.renderTargets;this.__offFormulaStatus__(),this.__loadCompleted__();var _=!this.util.isEmpty(f)||!this.util.isEmpty(d);h||_?(this.__renderModel__(h,d,f),this.__renderSelection__(),this.__triggerEvent__(s.EVENT_TYPE.DOCUMENT_UPDATED,r({},l,{self:i})),this.editor.execCommand(e.SET_CONTENTS_SCROLL_EVENT,!0)):i&&this.__triggerEvent__(s.EVENT_TYPE.DOCUMENT_UPDATED,r({},l,{self:i}))}else this.__yEvents__.push(t)},t.prototype.__offFormulaStatus__=function(){var t=this.selectionManager.selection,e=t.getFocusCell();this.editor.formulaManager.isEditingFormula()&&t.isInCell()&&!this.util.isFormulaText(e.getFirstChildText()[0])&&(this.editor.setFormulaEditMode(),this.formulaManager.setBackupFormula(null),this.selectionManager.setCaretById(t.anchor.id,0))},t.prototype.__initHistory__=function(){this.yDoc&&this.__useHistory__&&(this.__snapshotHistory__=new a.default(this.getSubDoc()))},t.prototype.__addHistory__=function(t,e){this.yDoc&&this.__useHistory__&&this.__snapshotHistory__.addSnapshot(t,e)},t.prototype.__refreshSelectionPosition__=function(){var t=this.selectionManager.selection;if(t.isDrawingObjectSelection()){var e=t.getDrawingObjectIds();if(t.isMultiSelection())this.selectionManager.setMultiSelection(e);else{var n=this.SEModelManager.getElement(e[0]);n&&this.selectionManager.setDrawingObjectSelection(n.getId())}}},t.prototype.__renderSelection__=function(){if(this.editor.isEditMode()){var t=this.selectionManager.selection,e=null;if(t.isValid()){var n=this.uiManager.getActiveBalloon();n&&(e=n.uiName)}else{var r=t.anchor,i=t.focus;this.positionManager.isValidPosition(r)?this.selectionManager.setCaretById(r.id,r.offset):this.positionManager.isValidPosition(i)?this.selectionManager.setCaretById(i.id,i.offset):this.selectionManager.refresh(),this.__updateUserInfo__()}this.__refreshSelectionPosition__(),this.selectionRenderer.isHandlerRunning()||this.selectionRenderer.renderSelection(this.selectionManager.selection,e)}},t.prototype.__renderRemoteSelections__=function(t){var e=this;if(this.util.isArray(t)&&t.forEach((function(t){return e.removedUserIds.add(t)})),this.editor.isEditMode()){var n=this.getUsers().filter((function(t){return!t.self}));this.editor.renderRemoteSelections(n,Array.from(this.removedUserIds)),this.removedUserIds.clear()}},t.prototype.__getRoot__=function(){if(this.yDoc)return this.yDoc.getMap()},t.prototype.__getSubRoot__=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.SUBDOC_ROOT_NAME.DEFAULT,e=this.getSubDoc();if(e)return e.getMap(t)},t.prototype.__getYModel__=function(t){var e=this.__getSubRoot__().get("body");return t.reduce((function(t,e){return t.get(e)}),e)},t.prototype.__getLastYModel__=function(t){for(var e=this.__getYModel__([]),n=-1,r=0;r<t.length;r++){var s=e.get(t[r]);if(!(s instanceof i.AbstractType)){n=r-1;break}e=s}return{model:e,index:n}},t.prototype.__getIsAlone__=function(){return this.__getRoot__().get(s.TYPE.IS_ALONE)},t.prototype.__getLastUserId__=function(){return this.__getRoot__().get(s.TYPE.LAST_USER_ID)},t.prototype.__getServerInfo__=function(){return this.__getRoot__().get(s.TYPE.SERVER_INFO)},t.prototype.__getUserMeta__=function(){return this.__getSubRoot__(s.SUBDOC_ROOT_NAME.META).get(s.SUBDOC_META_TYPE.USER)},t.prototype.__getYModelApplyValue__=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=void 0;if(n+1===e.length)s=this.util.cloneDeep(r);else for(var o=n+1,c=s=this.util.cloneDeep(t.get(e[n]));o<e.length;o++)o+1===e.length?i?delete c[e[o]]:c[e[o]]=r:c=c[e[o]];return s},t.prototype.__addYModel__=function(t){var e=t.path,n=t.rhs,r=t.index,i=this.util.last(e);if("children"===i){var s=this.__getYModel__(e);if(s)if(this.util.isNil(r))if(this.util.isArray(n)){var o=s.parent;o.delete("children"),o.set("children",this.__buildYModel__(n))}else s.insert(0,[this.__buildYModel__(n)]);else s.insert(r,[this.__buildYModel__(n)]);else if(this.util.isArray(n)){this.__getYModel__(e.slice(0,-1)).set(i,this.__buildYArray__(n))}}else if(this.util.isNil(r)){var c=this.__getLastYModel__(e),a=c.model,l=c.index+1,u=e[l],h=this.__getYModelApplyValue__(a,e,l,n);a.set(u,h)}else{var d=this.__getYModel__(e),f=this.__isYBuildTarget__(n)?this.__buildYModel__(n):n;d.insert(r,[f])}},t.prototype.__updateYModel__=function(t){var e=t.path,n=t.rhs,r=this.__getLastYModel__(e),s=r.model,o=r.index+1,c=e[o],a=this.__getYModelApplyValue__(s,e,o,n);s instanceof i.Array?(s.delete(c,1),s.insert(c,[a])):s instanceof i.Map&&s.set(c,a)},t.prototype.__deleteYModel__=function(t){var e=t.path,n=t.index;if(this.util.isNil(n)){var r=this.__getLastYModel__(e),i=r.model,s=r.index+1,o=e[s];if(s+1===e.length)i.delete(o);else{var c=this.__getYModelApplyValue__(i,e,s,null,!0);i.set(o,c)}}else{this.__getYModel__(e).delete(n,1)}},t.prototype.__buildYModel__=function(t){return this.util.isArray(t)?this.__buildYArray__(t):this.util.isObject(t)?this.__buildYMap__(t):t},t.prototype.__buildYMap__=function(t){var e=this;if(this.util.isArray(t)||!this.util.isObject(t))return t;var n=new i.Map;return Object.entries(t).forEach((function(t){var r=t[0],i=t[1];e.util.isArray(i)?n.set(r,e.__buildYArray__(i)):e.util.isObject(i)&&f.has(r)?n.set(r,e.__buildYMap__(i)):n.set(r,i)})),n},t.prototype.__buildYArray__=function(t){var e=this;if(!this.util.isArray(t))return t;var n=new i.Array;return n.push(t.map((function(t){return e.__buildYMap__(t)}))),n},t.prototype.__renderModel__=function(t,e,n){if(t&&this.__getSubRoot__().has("body")){var r=this.SEModelManager.getBody();r.children&&this.__renderAll__(),this.__addUpdatedModels__([r])}else n.length>0&&(this.modelHandler.addRenderTarget(n),this.renderManager.renderElements(),this.__addUpdatedModels__(n));t||this.util.isEmpty(e)||this.renderManager.updateBodyStyle()},t.prototype.__renderAll__=function(){this.editor.resize(),this.windowEventManager.block(),this.windowEventManager.unobserveEditorResize(),this.renderManager.renderAll(),this.selectionManager.selection.isValid()||this.selectionManager.refresh(),this.selectionRenderer.renderSelection(this.selectionManager.selection),this.windowEventManager.unblock(),this.windowEventManager.observeEditorResize(),this.__updateUserInfo__(),this.__renderRemoteSelections__()},t.prototype.undo=function(){this.__applyChangesBuffer__(),this.yUndoManager&&this.yUndoManager.undo(),this.__updateUndoRedoUIStatus__()},t.prototype.redo=function(){this.__applyChangesBuffer__(),this.yUndoManager&&this.yUndoManager.redo(),this.__updateUndoRedoUIStatus__()},t.prototype.on=function(t,e){Object.values(s.EVENT_TYPE).includes(t)&&this.util.isFunction(e)&&(this.__eventListenerMap__[t]||(this.__eventListenerMap__[t]=new Set),this.__eventListenerMap__[t].add(e))},t.prototype.off=function(t,e){this.util.get(this.__eventListenerMap__,t,new Set).delete(e)},t.prototype.getSubDoc=function(){return this.__getRoot__().get(s.TYPE.SUB)},t.prototype.getServerInfo=function(){return this.util.cloneDeep(this.__getServerInfo__())},t.prototype.getHistory=function(){return this.__useHistory__?this.__snapshotHistory__.getSnapshots():[]},t.prototype.applyChanges=function(){this.__applyChangesToYModel__()},t}();function g(t){return t instanceof i.Map?t.get("id")||t.get("hyperlinkId")||t.get("bookmarkId"):t.id||t.hyperlinkId||t.bookmarkId}function p(t){return t.reduce((function(t,e,n){return Number.isInteger(e)&&t.push(n),t}),[])}e.default=_},1641:function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"messageSync",(function(){return f})),n.d(e,"messageQueryAwareness",(function(){return _})),n.d(e,"messageAwareness",(function(){return g})),n.d(e,"messageAuth",(function(){return p})),n.d(e,"WebsocketProvider",(function(){return S}));var r=n(442),i=n(175),s=n(3),o=n(8),c=n(468),a=n(1019),l=n(418),u=n(466),h=n(27),d=n(1020);const f=0,_=3,g=1,p=2,y=[];y[f]=(t,e,n,r,i)=>{s.p(t,f);const o=c.b(e,t,n.doc,n);r&&o===c.a&&!n.synced&&(n.synced=!0)},y[_]=(t,e,n,r,i)=>{s.p(t,g),s.q(t,l.c(n.awareness,Array.from(n.awareness.getStates().keys())))},y[g]=(t,e,n,r,i)=>{l.b(n.awareness,o.l(e),n)},y[p]=(t,e,n,r,i)=>{a.a(e,n.doc,(t,e)=>w(n,e))};const w=(t,e)=>console.warn(`Permission denied to access ${t.url}.\n${e}`),m=(t,e,n)=>{const r=o.e(e),i=s.e(),c=o.k(r),a=t.messageHandlers[c];return a&&a(i,r,t,n,c),i},E=t=>{if(t.shouldConnect&&null===t.ws){const e=new t._WS(t.url);e.binaryType="arraybuffer",t.ws=e,t.wsconnecting=!0,t.wsconnected=!1,t.synced=!1,e.onmessage=n=>{t.wsLastMessageReceived=i.a();const r=m(t,new Uint8Array(n.data),!0);s.g(r)>1&&e.send(s.h(r))},e.onerror=e=>{t.emit("connection-error",[e,t])},e.onclose=e=>{t.emit("connection-close",[e,t]),t.ws=null,t.wsconnecting=!1,t.wsconnected?(t.wsconnected=!1,t.synced=!1,l.d(t.awareness,Array.from(t.awareness.getStates().keys()).filter(e=>e!==t.doc.clientID),t),t.emit("status",[{status:"disconnected"}])):t.wsUnsuccessfulReconnects++,setTimeout(E,h.h(100*h.i(2,t.wsUnsuccessfulReconnects),t.maxBackoffTime),t)},e.onopen=()=>{t.wsLastMessageReceived=i.a(),t.wsconnecting=!1,t.wsconnected=!0,t.wsUnsuccessfulReconnects=0,t.emit("status",[{status:"connected"}]);const n=s.e();if(s.p(n,f),c.c(n,t.doc),e.send(s.h(n)),null!==t.awareness.getLocalState()){const n=s.e();s.p(n,g),s.q(n,l.c(t.awareness,[t.doc.clientID])),e.send(s.h(n))}},t.emit("status",[{status:"connecting"}])}},b=(t,e)=>{const n=t.ws;t.wsconnected&&n&&n.readyState===n.OPEN&&n.send(e),t.bcconnected&&r.a(t.bcChannel,e,t)};class S extends u.a{constructor(e,n,o,{connect:a=!0,awareness:u=new l.a(o),params:h={},WebSocketPolyfill:_=WebSocket,resyncInterval:p=-1,maxBackoffTime:w=2500,disableBc:E=!1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);const S=d.a(h);this.maxBackoffTime=w,this.bcChannel=e+"/"+n,this.url=e+"/"+n+(0===S.length?"":"?"+S),this.roomname=n,this.doc=o,this._WS=_,this.awareness=u,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=E,this.wsUnsuccessfulReconnects=0,this.messageHandlers=y.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=a,this._resyncInterval=0,p>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const t=s.e();s.p(t,f),c.c(t,o),this.ws.send(s.h(t))}},p)),this._bcSubscriber=(t,e)=>{if(e!==this){const e=m(this,new Uint8Array(t),!1);s.g(e)>1&&r.a(this.bcChannel,s.h(e),this)}},this._updateHandler=(t,e)=>{if(e!==this){const e=s.e();s.p(e,f),c.e(e,t),b(this,s.h(e))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:t,updated:e,removed:n},r)=>{const i=t.concat(e).concat(n),o=s.e();s.p(o,g),s.q(o,l.c(u,i)),b(this,s.h(o))},this._unloadHandler=()=>{l.d(this.awareness,[o.clientID],"window unload")},"undefined"!=typeof window?window.addEventListener("unload",this._unloadHandler):void 0!==t&&t.on("exit",this._unloadHandler),u.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&3e4<i.a()-this.wsLastMessageReceived&&this.ws.close()},3e3),a&&this.connect()}get synced(){return this._synced}set synced(t){this._synced!==t&&(this._synced=t,this.emit("synced",[t]),this.emit("sync",[t]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),"undefined"!=typeof window?window.removeEventListener("unload",this._unloadHandler):void 0!==t&&t.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(r.b(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);const t=s.e();s.p(t,f),c.c(t,this.doc),r.a(this.bcChannel,s.h(t),this);const e=s.e();s.p(e,f),c.d(e,this.doc),r.a(this.bcChannel,s.h(e),this);const n=s.e();s.p(n,_),r.a(this.bcChannel,s.h(n),this);const i=s.e();s.p(i,g),s.q(i,l.c(this.awareness,[this.doc.clientID])),r.a(this.bcChannel,s.h(i),this)}disconnectBc(){const t=s.e();s.p(t,g),s.q(t,l.c(this.awareness,[this.doc.clientID],new Map)),b(this,s.h(t)),this.bcconnected&&(r.c(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(E(this),this.connectBc())}}}.call(this,n(1016))},1642:function(t,e,n){"use strict";e.__esModule=!0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(417)),i=n(441);var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.__yDoc__=e,this.__snapshots__=[],this.__mergingSnapshot__=null}return t.prototype.__createSnapshot__=function(t,e){return this.__yDoc__.gc&&(this.__yDoc__.gc=!1),{snapshot:r.encodeSnapshot(r.snapshot(this.__yDoc__)),user:t,rootModified:e,modified:Date.now()}},t.prototype.__shouldMerge__=function(t){if(0===this.__snapshots__.length)return!1;var e=this.__snapshots__[this.__snapshots__.length-1],n=!e.rootModified&&e.user.id===t.user.id;if(n)if(this.__mergingSnapshot__){var r=t.modified-this.__mergingSnapshot__.modified<3e4;n=r,r||(this.__mergingSnapshot__=null)}else n=!1,this.__mergingSnapshot__=e;else this.__mergingSnapshot__=null;return n},t.prototype.getSnapshots=function(){return this.__snapshots__},t.prototype.addSnapshot=function(t,e){var n=this.__createSnapshot__(t,e);this.__shouldMerge__(n)&&this.__snapshots__.pop(),this.__snapshots__.push(n),this.__snapshots__.length>i.DEFAULT_HISTORY_MAXIMUM&&(this.__snapshots__=this.__snapshots__.slice(1))},t}();e.default=s},1643:function(t,e,n){"use strict";e.__esModule=!0;var r=a(n(1644)),i=n(441),s=n(1018),o=a(n(785)),c=a(n(1017));function a(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=e,this.util=this.editor.util,this.collaboManager=n,this.isSynced=this.collaboManager.isSynced,this.collaboratorMenu=new r.default(this.editor,this.collaboManager),this.customIconSize=this.editor.getConfiguration("editor.ui.button.icon.size"),this.__attachEvent__()}return t.prototype.__attachEvent__=function(){var t=this,e=this.editor.constructor.CONST.CUSTOM_EVENT_TYPE;this.editor.getCustomEventManager().add(e.ALL_POPUPS_HIDDEN,(function(){var e=document.activeElement,n=t.collaboratorMenu.getTargetElement();e&&n&&n.querySelector("button")===e||t.hideMenu()})),this.collaboManager.on(i.EVENT_TYPE.USER_INFO_CHANGED,(function(e){t.editor.getUIManager().renderComponents(i.BUTTON_NAME.COLLABORATOR,e,!1),t.__updateCollaboratorMenu__(e)})),this.collaboManager.on(i.EVENT_TYPE.ON_SYNC,(function(e){var n=e.isSynced;t.isSynced=n,n?t.enableMenu():t.disableMenu()})),this.collaboManager.on(i.EVENT_TYPE.ON_CLOSE,(function(){t.isSynced=!1,t.editor.getUIManager().renderComponents(i.BUTTON_NAME.COLLABORATOR,{},!0),t.disableMenu()}))},t.prototype.__createIconElement__=function(t,e,n){var r=document.createElement("div");return r.className="se-icon",this.customIconSize&&(r.style.fontSize=this.customIconSize+"px"),r.style.background="url('data:image/svg+xml,"+encodeURIComponent((0,c.default)(t,e,n))+"') no-repeat center",r.title=t,r},t.prototype.__updateCollaboratorMenu__=function(t){this.collaboratorMenu.updateMenu(t)},t.prototype.getPanelContentHTML=function(){return(0,s.getPanelContentHTML)(this.customIconSize)},t.prototype.renderCollaboratorPanel=function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=t.querySelector(".se-panel-btn-wrapper"),c=t.querySelector(".se-panel-btn[value=main]"),a=t.querySelector(".se-panel-btn[value=sub] .se-user-count");if(!this.isSynced||r)return s.classList.add("se-disable"),c.innerHTML=this.editor.getMessage(o.default.DISCONNECTED),a.style.display="none",void(a.title="");s.classList.remove("se-disable"),c.innerHTML="",a.style.display="",a.innerHTML=e.length>i.USER_COUNT?i.USER_COUNT+"+":e.length,a.title=e.length,e.slice(0,i.ICON_COUNT).forEach((function(t){var e=n.__createIconElement__(t.name||i.NAME_PREFIX+t.id,t.color,t.self);c.appendChild(e)}))},t.prototype.hideMenu=function(){this.collaboratorMenu.hide()},t.prototype.enableMenu=function(){this.collaboratorMenu.enable()},t.prototype.disableMenu=function(){this.collaboratorMenu.disable()},t.prototype.toggleMenu=function(t){this.collaboratorMenu.toggle(t)},t}();e.default=l},1644:function(t,e,n){"use strict";e.__esModule=!0;var r,i=n(1017),s=(r=i)&&r.__esModule?r:{default:r},o=n(441);var c=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.editor=e,this.collaboManager=n,this.users=[],this.menuItemGroup=null,this.targetElement=null,this.isDisable=!0}return t.prototype.__updateMenu__=function(){var t=this;if(this.targetElement){var e=this.targetElement.querySelector(".se-panel-menu-wrapper");e.innerHTML="";var n=[];this.users.forEach((function(e,r){var i=e.name||o.NAME_PREFIX+e.id;1===r&&n.push({isSeparator:!0}),n.push({iconTagString:(0,s.default)(i,e.color,e.self),label:i,onClickFunc:function(){var n=void 0;(n=e.self?t.editor.getSelectionRenderer().getSECaret():t.editor.getSelectionRenderer().getSERemoteCaret(e.id))&&n.scrollIntoView({behavior:"smooth"})}})})),this.menuItemGroup=this.editor.getUIManager().createMenuItemGroup(null,n,{useMenuStyle:!0}),e.append(this.menuItemGroup.getElement().get(0))}},t.prototype.updateMenu=function(t){this.users=t,this.isShowed()&&this.__updateMenu__()},t.prototype.getTargetElement=function(){return this.targetElement},t.prototype.isShowed=function(){return!!this.menuItemGroup&&this.menuItemGroup.isShowed()},t.prototype.show=function(t){this.targetElement=t;var e=this.targetElement.querySelector(".se-panel-btn-wrapper");document.activeElement!==e&&e.focus(),e&&(e.addEventListener("blur",this.hide.bind(this),{once:!0}),e.classList.add("se-active")),this.__updateMenu__(),this.menuItemGroup.show()},t.prototype.hide=function(){if(this.menuItemGroup){var t=this.targetElement.querySelector(".se-panel-btn-wrapper");if(this.menuItemGroup.getElement().remove(),this.menuItemGroup=null,t&&(t.classList.remove("se-active"),document.activeElement===t)){var e=this.editor.constructor.ACTION;this.editor.execCommand(e.FOCUS_IME)}this.targetElement=null}},t.prototype.enable=function(){this.isDisable=!1},t.prototype.disable=function(){this.isDisable=!0},t.prototype.toggle=function(t){this.isDisable||(t&&this.targetElement===t&&this.isShowed()?this.hide():this.show(t))},t}();e.default=c},1645:function(t,e,n){"use strict";var r;e.__esModule=!0;var i,s=n(785),o=(i=s)&&i.__esModule?i:{default:i};e.default=((r={})[o.default.NOTIFICATION_CONFLICT]={en:"When editing the same paragraph, it may be edited differently than intended.",ko:"같은 문단 편집시 의도와 다르게 편집될 수 있습니다."},r[o.default.NOTIFICATION_MAX_PAYLOAD]={en:"Due to excessive editing, an error occurred, and the connection has been terminated. Please reconnect by refreshing the page. (The last edited content will not be preserved.)",ko:"너무 많은 양의 편집으로 인해 오류가 발생하여 연결이 종료되었습니다. 새로고침을 통해 다시 연결해주세요. (마지막 편집 내용은 유지되지 않습니다)"},r[o.default.UPDATE_HISTORY]={en:"Update History",ko:"업데이트 기록"},r[o.default.RESTORE]={en:"Restore",ko:"복구"},r[o.default.CLOSE]={en:"Close",ko:"닫기"},r[o.default.DISCONNECTED]={en:"Disconnected",ko:"연결되지 않음"},r[o.default.SYNC_DOCUMENT]={en:"Synchronizing Documents...",ko:"문서 동기화 중..."},r)},1646:function(t,e,n){"use strict";e.__esModule=!0,e.createHistoryDialog=function(t,e){return l.prototype=t.createCustomDialog(a.DIALOG_NAME.HISTORY,{title:t.getMessage(c.default.UPDATE_HISTORY),bodyHTML:(0,s.getHistoryDialogHTML)(t),footerButtons:[{type:"confirm",point:!0,label:t.getMessage(c.default.RESTORE)},{type:"cancel",point:!1,label:t.getMessage(c.default.CLOSE)}]}),new l(t,e)};var r,i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(417)),s=n(1018),o=n(785),c=(r=o)&&r.__esModule?r:{default:r},a=n(441);function l(t,e){var n=this;return this instanceof l?(this.editor=t,this.util=this.editor.util,this.collaboManager=e,this.historyData=[],this.user={},this.$previewArea=this.$element.find(".se-history-preview"),this.versionSelectList=t.getUIManager().createSelectList(),this.versionSelectList.attachChangeEvent((function(t){return n.__updatePreview__(t)})),this.$element.find(".se-version-list").append(this.versionSelectList.getElement()),this.__attachEvent__=function(){n.$element.on("click","[value=back]",n.back.bind(n)),n.$element.on("click",".se-confirm",n.confirm.bind(n)),l.prototype.attachEvent.call(n)},this.__init__=function(){if(n.historyData=n.collaboManager.getHistory(),!n.editor.util.isEmpty(n.historyData)){var t=n.historyData.map((function(t,e){return{label:n.editor.util.getFormattedDate(t.modified),value:e}}));n.versionSelectList.setItems(t.reverse()),n.versionSelectList.setValueByIndex(0)}},this.__getModelData__=function(t){var e={model:null,user:null},r=n.historyData[t]||{};if(r.snapshot){var i=n.__decodeSnapshotData__(r.snapshot);e.model=i,e.user=r.user||{}}return e},this.__getBeforeModelData__=function(t){var e={model:null,user:null},r=parseInt(t,10)-1,i=n.historyData[r]||{};if(i.snapshot){var s=n.__decodeSnapshotData__(i.snapshot);e.model=s,e.user=i.user}return e},this.__changeBackgroundStyle__=function(t,e){t.css({backgroundImage:e.css("background-image"),backgroundAttachment:e.css("background-attachment"),backgroundRepeat:e.css("background-repeat"),backgroundPosition:e.css("background-position"),backgroundSize:e.css("background-size"),backgroundColor:e.css("background-color")}),e.css({backgroundImage:"",backgroundAttachment:"",backgroundRepeat:"",backgroundPosition:"",backgroundSize:"",backgroundColor:""})},this.__decodeSnapshotData__=function(t){var n=i.decodeSnapshot(t);return i.createDocFromSnapshot(e.getSubDoc(),n).getMap().toJSON().body},this.__getLatestUserInfo__=function(t){var e=n.collaboManager.getUsers().find((function(e){return e.id===t.id}));return e?n.util.cloneDeep(e):t},this.__updatePreview__=function(t){var e=n.__getModelData__(t);if(e){n.user=n.__getLatestUserInfo__(e.user);var r={contentPadding:"document"},i=n.__getBeforeModelData__(t);if(i.model){var s=n.editor.getModelDiffHTML(i.model,e.model,{htmlOptions:r});n.$previewArea.html(s)}else n.$previewArea.html(n.editor.getModelHTML(e.model,r));n.__changeBackgroundStyle__(n.$previewArea,n.$previewArea.find(".se-contents"))}},this.show=function(t){l.prototype.show.call(n,t),n.__init__()},this.hide=function(){l.prototype.hide.call(n)},this.confirm=function(){var t=n.versionSelectList.getValue();if(t){var e=n.editor.constructor.ACTION,r=n.__getModelData__(t);n.editor.execCommand(e.OPEN_MODEL,r.model,{loadingProgress:!1})}l.prototype.confirm.call(n)},n.__attachEvent__(),n):new l(t)}},1647:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){var n=t.constructor,r=n.ACTION,i=n.CONST,c=i.UI_TYPE,a=i.UI_NAME,l=(t.getConfiguration(o.PLUGIN_NAME+".config")||{}).useHistory,u=[];u.push({type:c.PANEL,name:o.BUTTON_NAME.COLLABORATOR,content:e.getPanelContentHTML(),onClickFunc:function(t){var n=t.currentTarget;e.toggleMenu(n)},status:{render:function(t,n,r){e.renderCollaboratorPanel(t,n,r)}}}),l&&u.push({type:c.BUTTON,name:o.BUTTON_NAME.UPDATE_HISTORY,label:t.getMessage(s.default.UPDATE_HISTORY),iconName:a.UPDATE_HISTORY,onClickFunc:function(){t.execCommand(r.SHOW_DIALOG,o.DIALOG_NAME.HISTORY)}});return u};var r,i=n(785),s=(r=i)&&r.__esModule?r:{default:r},o=n(441)},174:function(t,e,n){"use strict";n.d(e,"d",(function(){return i})),n.d(e,"c",(function(){return c})),n.d(e,"g",(function(){return a})),n.d(e,"b",(function(){return l})),n.d(e,"f",(function(){return u})),n.d(e,"a",(function(){return h})),n.d(e,"e",(function(){return d}));var r=n(73);const i=String.fromCharCode,s=(String.fromCodePoint,i(65535),/^\s*/g),o=/([A-Z])/g,c=(t,e)=>(t=>t.replace(s,""))(t.replace(o,t=>`${e}${(t=>t.toLowerCase())(t)}`)),a="undefined"!=typeof TextEncoder?new TextEncoder:null,l=a?t=>a.encode(t):t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.codePointAt(t);return r};let u="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});u&&1===u.decode(new Uint8Array).length&&(u=null);const h=u?t=>u.decode(t):t=>{let e=t.length,n="",r=0;for(;e>0;){const i=e<1e4?e:1e4,s=t.subarray(r,r+i);r+=i,n+=String.fromCodePoint.apply(null,s),e-=i}return decodeURIComponent(escape(n))},d=(t,e)=>r.h(e,()=>t).join("")},175:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));n(27);const r=Date.now},18:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"d",(function(){return o})),n.d(e,"e",(function(){return c})),n.d(e,"f",(function(){return a})),n.d(e,"g",(function(){return l})),n.d(e,"k",(function(){return u})),n.d(e,"l",(function(){return h})),n.d(e,"m",(function(){return d})),n.d(e,"n",(function(){return f})),n.d(e,"h",(function(){return _})),n.d(e,"i",(function(){return g})),n.d(e,"j",(function(){return p}));const r=1,i=2,s=4,o=8,c=32,a=64,l=128,u=31,h=63,d=127,f=255,_=2097151,g=2147483647,p=4294967295},235:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}));const r=()=>new Set,i=t=>new Set(t)},259:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"e",(function(){return o})),n.d(e,"c",(function(){return c})),n.d(e,"b",(function(){return a})),n.d(e,"d",(function(){return l}));var r=n(73),i=n(278);const s=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&s(t,e,n+1)}},o=()=>{},c=t=>t,a=(t,e)=>{if(null==t||null==e)return((t,e)=>t===e)(t,e);if(t.constructor!==e.constructor)return!1;if(t===e)return!0;switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break;case Set:if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break;case Map:if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!a(t.get(n),e.get(n)))return!1;break;case Object:if(i.f(t)!==i.f(e))return!1;for(const n in t)if(!i.d(t,n)||!a(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!a(t[n],e[n]))return!1;break;default:return!1}return!0},l=(t,e)=>e.includes(t);r.d},27:function(t,e,n){"use strict";n.d(e,"d",(function(){return r})),n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return s})),n.d(e,"j",(function(){return o})),n.d(e,"f",(function(){return c})),n.d(e,"h",(function(){return a})),n.d(e,"g",(function(){return l})),n.d(e,"i",(function(){return u})),n.d(e,"c",(function(){return h})),n.d(e,"e",(function(){return d}));const r=Math.floor,i=Math.ceil,s=Math.abs,o=(Math.imul,Math.round),c=Math.log10,a=(Math.log2,Math.log,Math.sqrt,(t,e)=>t<e?t:e),l=(t,e)=>t>e?t:e,u=(Number.isNaN,Math.pow),h=t=>Math.pow(10,t),d=(Math.sign,t=>0!==t?t<0:1/t<0)},278:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"g",(function(){return o})),n.d(e,"f",(function(){return c})),n.d(e,"e",(function(){return a})),n.d(e,"d",(function(){return l})),n.d(e,"b",(function(){return u}));const r=Object.assign,i=Object.keys,s=(t,e)=>{for(const n in t)e(t[n],n)},o=(t,e)=>{const n=[];for(const r in t)n.push(e(t[r],r));return n},c=t=>i(t).length,a=t=>{for(const e in t)return!1;return!0},l=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),u=(t,e)=>t===e||c(t)===c(e)&&((t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0})(t,(t,n)=>(void 0!==t||l(e,n))&&e[n]===t)},3:function(t,e,n){"use strict";n.d(e,"e",(function(){return l})),n.d(e,"f",(function(){return u})),n.d(e,"g",(function(){return h})),n.d(e,"h",(function(){return d})),n.d(e,"i",(function(){return f})),n.d(e,"l",(function(){return _})),n.d(e,"p",(function(){return g})),n.d(e,"n",(function(){return p})),n.d(e,"o",(function(){return m})),n.d(e,"k",(function(){return E})),n.d(e,"m",(function(){return b})),n.d(e,"q",(function(){return S})),n.d(e,"j",(function(){return k})),n.d(e,"b",(function(){return I})),n.d(e,"d",(function(){return C})),n.d(e,"a",(function(){return D})),n.d(e,"c",(function(){return O}));var r=n(27),i=n(786),s=n(18),o=n(174),c=n(73);class a{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const l=()=>new a,u=t=>{const e=l();return t(e),d(e)},h=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},d=t=>{const e=new Uint8Array(h(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},f=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(2*n),t.cpos=0),t.cbuf[t.cpos++]=e},_=f,g=(t,e)=>{for(;e>s.m;)f(t,s.g|s.m&e),e=r.d(e/128);f(t,s.m&e)},p=(t,e)=>{const n=r.e(e);for(n&&(e=-e),f(t,(e>s.l?s.g:0)|(n?s.f:0)|s.l&e),e=r.d(e/64);e>0;)f(t,(e>s.m?s.g:0)|s.m&e),e=r.d(e/128)},y=new Uint8Array(3e4),w=y.length/3,m=o.g&&o.g.encodeInto?(t,e)=>{if(e.length<w){const n=o.g.encodeInto(e,y).written||0;g(t,n);for(let e=0;e<n;e++)f(t,y[e])}else S(t,o.b(e))}:(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;g(t,r);for(let e=0;e<r;e++)f(t,n.codePointAt(e))},E=(t,e)=>b(t,d(e)),b=(t,e)=>{const n=t.cbuf.length,i=t.cpos,s=r.h(n-i,e.length),o=e.length-s;t.cbuf.set(e.subarray(0,s),i),t.cpos+=s,o>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(r.g(2*n,o)),t.cbuf.set(e.subarray(s)),t.cpos=o)},S=(t,e)=>{g(t,e.byteLength),b(t,e)},v=(t,e)=>{((t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(2*r.g(n,e)),t.cpos=0)})(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},M=new DataView(new ArrayBuffer(4)),k=(t,e)=>{switch(typeof e){case"string":f(t,119),m(t,e);break;case"number":i.b(e)&&r.a(e)<=s.i?(f(t,125),p(t,e)):(n=e,M.setFloat32(0,n),M.getFloat32(0)===n?(f(t,124),((t,e)=>{v(t,4).setFloat32(0,e,!1)})(t,e)):(f(t,123),((t,e)=>{v(t,8).setFloat64(0,e,!1)})(t,e)));break;case"bigint":f(t,122),((t,e)=>{v(t,8).setBigInt64(0,e,!1)})(t,e);break;case"object":if(null===e)f(t,126);else if(c.d(e)){f(t,117),g(t,e.length);for(let n=0;n<e.length;n++)k(t,e[n])}else if(e instanceof Uint8Array)f(t,116),S(t,e);else{f(t,118);const n=Object.keys(e);g(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];m(t,i),k(t,e[i])}}break;case"boolean":f(t,e?120:121);break;default:f(t,127)}var n};class I extends a{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&g(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const A=t=>{t.count>0&&(p(t.encoder,1===t.count?t.s:-t.s),t.count>1&&g(t.encoder,t.count-2))};class C{constructor(){this.encoder=new a,this.s=0,this.count=0}write(t){this.s===t?this.count++:(A(this),this.count=1,this.s=t)}toUint8Array(){return A(this),d(this.encoder)}}const T=t=>{if(t.count>0){const e=2*t.diff+(1===t.count?0:1);p(t.encoder,e),t.count>1&&g(t.encoder,t.count-2)}};class D{constructor(){this.encoder=new a,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(T(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return T(this),d(this.encoder)}}class O{constructor(){this.sarr=[],this.s="",this.lensE=new C}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new a;return this.sarr.push(this.s),this.s="",m(t,this.sarr.join("")),b(t,this.lensE.toUint8Array()),d(t)}}},31:function(t,e,n){"use strict";n.d(e,"c",(function(){return r})),n.d(e,"b",(function(){return i})),n.d(e,"e",(function(){return s})),n.d(e,"d",(function(){return o})),n.d(e,"a",(function(){return c}));const r=()=>new Map,i=t=>{const e=r();return t.forEach((t,n)=>{e.set(n,t)}),e},s=(t,e,n)=>{let r=t.get(e);return void 0===r&&t.set(e,r=n()),r},o=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},c=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1}},36:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},417:function(t,e,n){"use strict";n.r(e),n.d(e,"AbsolutePosition",(function(){return Vt})),n.d(e,"AbstractConnector",(function(){return W})),n.d(e,"AbstractStruct",(function(){return ir})),n.d(e,"AbstractType",(function(){return fn})),n.d(e,"Array",(function(){return Nn})),n.d(e,"ContentAny",(function(){return fr})),n.d(e,"ContentBinary",(function(){return or})),n.d(e,"ContentDeleted",(function(){return cr})),n.d(e,"ContentEmbed",(function(){return ur})),n.d(e,"ContentFormat",(function(){return hr})),n.d(e,"ContentJSON",(function(){return dr})),n.d(e,"ContentString",(function(){return _r})),n.d(e,"ContentType",(function(){return vr})),n.d(e,"Doc",(function(){return st})),n.d(e,"GC",(function(){return sr})),n.d(e,"ID",(function(){return Ot})),n.d(e,"Item",(function(){return Tr})),n.d(e,"Map",(function(){return Ln})),n.d(e,"PermanentUserData",(function(){return Yt})),n.d(e,"RelativePosition",(function(){return Ft})),n.d(e,"Snapshot",(function(){return Kt})),n.d(e,"Text",(function(){return Xn})),n.d(e,"Transaction",(function(){return me})),n.d(e,"UndoManager",(function(){return Oe})),n.d(e,"UpdateEncoderV1",(function(){return ht})),n.d(e,"XmlElement",(function(){return tr})),n.d(e,"XmlFragment",(function(){return Qn})),n.d(e,"XmlHook",(function(){return nr})),n.d(e,"XmlText",(function(){return rr})),n.d(e,"YArrayEvent",(function(){return Un})),n.d(e,"YEvent",(function(){return rn})),n.d(e,"YMapEvent",(function(){return Rn})),n.d(e,"YTextEvent",(function(){return Kn})),n.d(e,"YXmlEvent",(function(){return er})),n.d(e,"applyUpdate",(function(){return wt})),n.d(e,"applyUpdateV2",(function(){return yt})),n.d(e,"cleanupYTextFormatting",(function(){return Jn})),n.d(e,"compareIDs",(function(){return Ut})),n.d(e,"compareRelativePositions",(function(){return $t})),n.d(e,"convertUpdateFormatV1ToV2",(function(){return tn})),n.d(e,"convertUpdateFormatV2ToV1",(function(){return en})),n.d(e,"createAbsolutePositionFromRelativePosition",(function(){return qt})),n.d(e,"createDeleteSet",(function(){return Z})),n.d(e,"createDeleteSetFromStructStore",(function(){return Q})),n.d(e,"createDocFromSnapshot",(function(){return ce})),n.d(e,"createID",(function(){return Nt})),n.d(e,"createRelativePositionFromJSON",(function(){return jt})),n.d(e,"createRelativePositionFromTypeIndex",(function(){return zt})),n.d(e,"createSnapshot",(function(){return ne})),n.d(e,"decodeRelativePosition",(function(){return Jt})),n.d(e,"decodeSnapshot",(function(){return ee})),n.d(e,"decodeSnapshotV2",(function(){return te})),n.d(e,"decodeStateVector",(function(){return St})),n.d(e,"decodeUpdate",(function(){return Le})),n.d(e,"decodeUpdateV2",(function(){return Pe})),n.d(e,"diffUpdate",(function(){return Ge})),n.d(e,"diffUpdateV2",(function(){return ze})),n.d(e,"emptySnapshot",(function(){return re})),n.d(e,"encodeRelativePosition",(function(){return Gt})),n.d(e,"encodeSnapshot",(function(){return Qt})),n.d(e,"encodeSnapshotV2",(function(){return Zt})),n.d(e,"encodeStateAsUpdate",(function(){return Et})),n.d(e,"encodeStateAsUpdateV2",(function(){return mt})),n.d(e,"encodeStateVector",(function(){return kt})),n.d(e,"encodeStateVectorFromUpdate",(function(){return Fe})),n.d(e,"encodeStateVectorFromUpdateV2",(function(){return Ye})),n.d(e,"equalDeleteSets",(function(){return rt})),n.d(e,"equalSnapshots",(function(){return Xt})),n.d(e,"findIndexSS",(function(){return fe})),n.d(e,"findRootTypeKey",(function(){return Pt})),n.d(e,"getItem",(function(){return _e})),n.d(e,"getState",(function(){return he})),n.d(e,"getTypeChildren",(function(){return hn})),n.d(e,"isDeleted",(function(){return q})),n.d(e,"isParentOf",(function(){return Bt})),n.d(e,"iterateDeletedStructs",(function(){return J})),n.d(e,"logType",(function(){return xt})),n.d(e,"logUpdate",(function(){return Ne})),n.d(e,"logUpdateV2",(function(){return Re})),n.d(e,"mergeUpdates",(function(){return xe})),n.d(e,"mergeUpdatesV2",(function(){return We})),n.d(e,"obfuscateUpdate",(function(){return Ze})),n.d(e,"obfuscateUpdateV2",(function(){return Qe})),n.d(e,"parseUpdateMeta",(function(){return je})),n.d(e,"parseUpdateMetaV2",(function(){return He})),n.d(e,"readUpdate",(function(){return pt})),n.d(e,"readUpdateV2",(function(){return gt})),n.d(e,"relativePositionToJSON",(function(){return Ht})),n.d(e,"snapshot",(function(){return ie})),n.d(e,"snapshotContainsUpdate",(function(){return ae})),n.d(e,"transact",(function(){return Ae})),n.d(e,"tryGc",(function(){return ke})),n.d(e,"typeListToArraySnapshot",(function(){return pn})),n.d(e,"typeMapGetSnapshot",(function(){return Dn}));var r=n(466),i=n(73),s=n(27),o=n(31),c=n(3),a=n(8),l=n(18);crypto.subtle;const u=crypto.getRandomValues.bind(crypto),h=(Math.random,()=>u(new Uint32Array(1))[0]),d=[1e7]+-1e3+-4e3+-8e3+-1e11,f=()=>d.replace(/[018]/g,t=>(t^h()&15>>t/4).toString(16));var _=n(175);const g=t=>new Promise(t);Promise.all.bind(Promise);var p=n(745),y=n(58),w=n(259),m=n(235),E=n(467);class b{constructor(t,e){this.left=t,this.right=e}}const S=(t,e)=>new b(t,e),v="undefined"!=typeof document?document:{},M=("undefined"!=typeof DOMParser&&new DOMParser,t=>o.d(t,(t,e)=>`${e}:${t};`).join(""));v.ELEMENT_NODE,v.TEXT_NODE,v.CDATA_SECTION_NODE,v.COMMENT_NODE,v.DOCUMENT_NODE,v.DOCUMENT_TYPE_NODE,v.DOCUMENT_FRAGMENT_NODE,JSON.stringify,JSON.parse;const k=t=>class{constructor(t){this._=t}destroy(){t(this._)}},I=(k(clearTimeout),k(clearInterval),k(t=>"undefined"!=typeof requestAnimationFrame&&cancelAnimationFrame(t)),k(t=>"undefined"!=typeof cancelIdleCallback&&cancelIdleCallback(t)),Symbol),A=I(),C=I(),T=I(),D=I(),O=I(),U=I(),N=I(),R=I(),L=I();_.a();const P={[A]:S("font-weight","bold"),[C]:S("font-weight","normal"),[T]:S("color","blue"),[O]:S("color","green"),[D]:S("color","grey"),[U]:S("color","red"),[N]:S("color","purple"),[R]:S("color","orange"),[L]:S("color","black")},B=E.c?t=>{const e=[],n=[],r=o.c();let i=[],s=0;for(;s<t.length;s++){const i=t[s],o=P[i];if(void 0!==o)r.set(o.left,o.right);else{if(i.constructor!==String&&i.constructor!==Number)break;{const t=M(r);s>0||t.length>0?(e.push("%c"+i),n.push(t)):e.push(i)}}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const e=t[s];e instanceof Symbol||i.push(e)}return i}:t=>{const e=[],n=[];let r=0;for(;r<t.length;r++){const i=t[r];i.constructor===String||i.constructor===Number?e.push(i):i.constructor===Object&&n.push(JSON.stringify(i))}return n},x=(...t)=>{B(t),Y.forEach(e=>e.print(t))},Y=m.a();var F=n(174);const H=t=>({[Symbol.iterator](){return this},next:t}),j=(t,e)=>H(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});var V=n(278);class W extends r.a{constructor(t,e){super(),this.doc=t,this.awareness=e}}class z{constructor(t,e){this.clock=t,this.len=e}}class G{constructor(){this.clients=new Map}}const J=(t,e,n)=>e.clients.forEach((e,r)=>{const i=t.doc.store.clients.get(r);for(let r=0;r<e.length;r++){const s=e[r];we(t,i,s.clock,s.len,n)}}),q=(t,e)=>{const n=t.clients.get(e.client);return void 0!==n&&null!==((t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=s.d((n+r)/2),o=t[i],c=o.clock;if(c<=e){if(e<c+o.len)return i;n=i+1}else r=i-1}return null})(n,e.clock)},$=t=>{t.clients.forEach(t=>{let e,n;for(t.sort((t,e)=>t.clock-e.clock),e=1,n=1;e<t.length;e++){const r=t[n-1],i=t[e];r.clock+r.len>=i.clock?r.len=s.g(r.len,i.clock+i.len-r.clock):(n<e&&(t[n]=i),n++)}t.length=n})},K=t=>{const e=new G;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,s)=>{if(!e.clients.has(s)){const o=r.slice();for(let e=n+1;e<t.length;e++)i.a(o,t[e].clients.get(s)||[]);e.clients.set(s,o)}});return $(e),e},X=(t,e,n,r)=>{o.e(t.clients,e,()=>[]).push(new z(n,r))},Z=()=>new G,Q=t=>{const e=Z();return t.clients.forEach((t,n)=>{const r=[];for(let e=0;e<t.length;e++){const n=t[e];if(n.deleted){const i=n.id.clock;let s=n.length;if(e+1<t.length)for(let n=t[e+1];e+1<t.length&&n.deleted;n=t[1+ ++e])s+=n.length;r.push(new z(i,s))}}r.length>0&&e.clients.set(n,r)}),e},tt=(t,e)=>{c.p(t.restEncoder,e.clients.size),i.c(e.clients.entries()).sort((t,e)=>e[0]-t[0]).forEach(([e,n])=>{t.resetDsCurVal(),c.p(t.restEncoder,e);const r=n.length;c.p(t.restEncoder,r);for(let e=0;e<r;e++){const r=n[e];t.writeDsClock(r.clock),t.writeDsLen(r.len)}})},et=t=>{const e=new G,n=a.k(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const n=a.k(t.restDecoder),r=a.k(t.restDecoder);if(r>0){const i=o.e(e.clients,n,()=>[]);for(let e=0;e<r;e++)i.push(new z(t.readDsClock(),t.readDsLen()))}}return e},nt=(t,e,n)=>{const r=new G,i=a.k(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const i=a.k(t.restDecoder),s=a.k(t.restDecoder),o=n.clients.get(i)||[],c=he(n,i);for(let n=0;n<s;n++){const n=t.readDsClock(),s=n+t.readDsLen();if(n<c){c<s&&X(r,i,c,s-c);let t=fe(o,n),a=o[t];for(!a.deleted&&a.id.clock<n&&(o.splice(t+1,0,Ir(e,a,n-a.id.clock)),t++);t<o.length&&(a=o[t++],a.id.clock<s);)a.deleted||(s<a.id.clock+a.length&&o.splice(t,0,Ir(e,a,s-a.id.clock)),a.delete(e))}else X(r,i,n,s-n)}}if(r.clients.size>0){const t=new ft;return c.p(t.restEncoder,0),tt(t,r),t.toUint8Array()}return null},rt=(t,e)=>{if(t.clients.size!==e.clients.size)return!1;for(const[n,r]of t.clients.entries()){const t=e.clients.get(n);if(void 0===t||r.length!==t.length)return!1;for(let e=0;e<r.length;e++){const n=r[e],i=t[e];if(n.clock!==i.clock||n.len!==i.len)return!1}}return!0},it=h;class st extends r.a{constructor({guid:t=f(),collectionid:e=null,gc:n=!0,gcFilter:r=(()=>!0),meta:i=null,autoLoad:s=!1,shouldLoad:o=!0}={}){super(),this.gc=n,this.gcFilter=r,this.clientID=it(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new le,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=o,this.autoLoad=s,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=g(t=>{this.on("load",()=>{this.isLoaded=!0,t(this)})});const c=()=>g(t=>{const e=n=>{void 0!==n&&!0!==n||(this.off("sync",e),t())};this.on("sync",e)});this.on("sync",t=>{!1===t&&this.isSynced&&(this.whenSynced=c()),this.isSynced=void 0===t||!0===t,this.isLoaded||this.emit("load",[])}),this.whenSynced=c()}load(){const t=this._item;null===t||this.shouldLoad||Ae(t.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(i.c(this.subdocs).map(t=>t.guid))}transact(t,e=null){return Ae(this,t,e)}get(t,e=fn){const n=o.e(this.share,t,()=>{const t=new e;return t._integrate(this,null),t}),r=n.constructor;if(e!==fn&&r!==e){if(r===fn){const r=new e;r._map=n._map,n._map.forEach(t=>{for(;null!==t;t=t.left)t.parent=r}),r._start=n._start;for(let t=r._start;null!==t;t=t.right)t.parent=r;return r._length=n._length,this.share.set(t,r),r._integrate(this,null),r}throw new Error(`Type with the name ${t} has already been defined with a different constructor`)}return n}getArray(t=""){return this.get(t,Nn)}getText(t=""){return this.get(t,Xn)}getMap(t=""){return this.get(t,Ln)}getXmlFragment(t=""){return this.get(t,Qn)}toJSON(){const t={};return this.share.forEach((e,n)=>{t[n]=e.toJSON()}),t}destroy(){i.c(this.subdocs).forEach(t=>t.destroy());const t=this._item;if(null!==t){this._item=null;const e=t.content;e.doc=new st({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,Ae(t.parent.doc,n=>{const r=e.doc;t.deleted||n.subdocsAdded.add(r),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}}class ot{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return a.k(this.restDecoder)}readDsLen(){return a.k(this.restDecoder)}}class ct extends ot{readLeftID(){return Nt(a.k(this.restDecoder),a.k(this.restDecoder))}readRightID(){return Nt(a.k(this.restDecoder),a.k(this.restDecoder))}readClient(){return a.k(this.restDecoder)}readInfo(){return a.h(this.restDecoder)}readString(){return a.j(this.restDecoder)}readParentInfo(){return 1===a.k(this.restDecoder)}readTypeRef(){return a.k(this.restDecoder)}readLen(){return a.k(this.restDecoder)}readAny(){return a.g(this.restDecoder)}readBuf(){return p.a(a.l(this.restDecoder))}readJSON(){return JSON.parse(a.j(this.restDecoder))}readKey(){return a.j(this.restDecoder)}}class at{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=a.k(this.restDecoder),this.dsCurrVal}readDsLen(){const t=a.k(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class lt extends at{constructor(t){super(t),this.keys=[],a.k(t),this.keyClockDecoder=new a.a(a.l(t)),this.clientDecoder=new a.d(a.l(t)),this.leftClockDecoder=new a.a(a.l(t)),this.rightClockDecoder=new a.a(a.l(t)),this.infoDecoder=new a.b(a.l(t),a.h),this.stringDecoder=new a.c(a.l(t)),this.parentInfoDecoder=new a.b(a.l(t),a.h),this.typeRefDecoder=new a.d(a.l(t)),this.lenDecoder=new a.d(a.l(t))}readLeftID(){return new Ot(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ot(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return a.g(this.restDecoder)}readBuf(){return a.l(this.restDecoder)}readJSON(){return a.g(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class ut{constructor(){this.restEncoder=c.e()}toUint8Array(){return c.h(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){c.p(this.restEncoder,t)}writeDsLen(t){c.p(this.restEncoder,t)}}class ht extends ut{writeLeftID(t){c.p(this.restEncoder,t.client),c.p(this.restEncoder,t.clock)}writeRightID(t){c.p(this.restEncoder,t.client),c.p(this.restEncoder,t.clock)}writeClient(t){c.p(this.restEncoder,t)}writeInfo(t){c.l(this.restEncoder,t)}writeString(t){c.o(this.restEncoder,t)}writeParentInfo(t){c.p(this.restEncoder,t?1:0)}writeTypeRef(t){c.p(this.restEncoder,t)}writeLen(t){c.p(this.restEncoder,t)}writeAny(t){c.j(this.restEncoder,t)}writeBuf(t){c.q(this.restEncoder,t)}writeJSON(t){c.o(this.restEncoder,JSON.stringify(t))}writeKey(t){c.o(this.restEncoder,t)}}class dt{constructor(){this.restEncoder=c.e(),this.dsCurrVal=0}toUint8Array(){return c.h(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,c.p(this.restEncoder,e)}writeDsLen(t){0===t&&y.c(),c.p(this.restEncoder,t-1),this.dsCurrVal+=t}}class ft extends dt{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new c.a,this.clientEncoder=new c.d,this.leftClockEncoder=new c.a,this.rightClockEncoder=new c.a,this.infoEncoder=new c.b(c.l),this.stringEncoder=new c.c,this.parentInfoEncoder=new c.b(c.l),this.typeRefEncoder=new c.d,this.lenEncoder=new c.d}toUint8Array(){const t=c.e();return c.p(t,0),c.q(t,this.keyClockEncoder.toUint8Array()),c.q(t,this.clientEncoder.toUint8Array()),c.q(t,this.leftClockEncoder.toUint8Array()),c.q(t,this.rightClockEncoder.toUint8Array()),c.q(t,c.h(this.infoEncoder)),c.q(t,this.stringEncoder.toUint8Array()),c.q(t,c.h(this.parentInfoEncoder)),c.q(t,this.typeRefEncoder.toUint8Array()),c.q(t,this.lenEncoder.toUint8Array()),c.m(t,c.h(this.restEncoder)),c.h(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){c.j(this.restEncoder,t)}writeBuf(t){c.q(this.restEncoder,t)}writeJSON(t){c.j(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);void 0===e?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const _t=(t,e,n)=>{const r=new Map;n.forEach((t,n)=>{he(e,n)>t&&r.set(n,t)}),ue(e).forEach((t,e)=>{n.has(e)||r.set(e,0)}),c.p(t.restEncoder,r.size),i.c(r.entries()).sort((t,e)=>e[0]-t[0]).forEach(([n,r])=>{((t,e,n,r)=>{r=s.g(r,e[0].id.clock);const i=fe(e,r);c.p(t.restEncoder,e.length-i),t.writeClient(n),c.p(t.restEncoder,r);const o=e[i];o.write(t,r-o.id.clock);for(let n=i+1;n<e.length;n++)e[n].write(t,0)})(t,e.clients.get(n),n,r)})},gt=(t,e,n,r=new lt(t))=>Ae(e,t=>{t.local=!1;let e=!1;const n=t.doc,s=n.store,u=((t,e,n)=>{const r=[];let s=i.c(n.keys()).sort((t,e)=>t-e);if(0===s.length)return null;const a=()=>{if(0===s.length)return null;let t=n.get(s[s.length-1]);for(;t.refs.length===t.i;){if(s.pop(),!(s.length>0))return null;t=n.get(s[s.length-1])}return t};let l=a();if(null===l&&0===r.length)return null;const u=new le,h=new Map,d=(t,e)=>{const n=h.get(t);(null==n||n>e)&&h.set(t,e)};let f=l.refs[l.i++];const _=new Map,g=()=>{for(const t of r){const e=t.id.client,r=n.get(e);r?(r.i--,u.clients.set(e,r.refs.slice(r.i)),n.delete(e),r.i=0,r.refs=[]):u.clients.set(e,[t]),s=s.filter(t=>t!==e)}r.length=0};for(;;){if(f.constructor!==Ur){const i=o.e(_,f.id.client,()=>he(e,f.id.client))-f.id.clock;if(i<0)r.push(f),d(f.id.client,f.id.clock-1),g();else{const s=f.getMissing(t,e);if(null!==s){r.push(f);const t=n.get(s)||{refs:[],i:0};if(t.refs.length!==t.i){f=t.refs[t.i++];continue}d(s,he(e,s)),g()}else(0===i||i<f.length)&&(f.integrate(t,i),_.set(f.id.client,f.id.clock+f.length))}}if(r.length>0)f=r.pop();else if(null!==l&&l.i<l.refs.length)f=l.refs[l.i++];else{if(l=a(),null===l)break;f=l.refs[l.i++]}}if(u.clients.size>0){const t=new ft;return _t(t,u,new Map),c.p(t.restEncoder,0),{missing:h,update:t.toUint8Array()}}return null})(t,s,((t,e)=>{const n=o.c(),r=a.k(t.restDecoder);for(let i=0;i<r;i++){const r=a.k(t.restDecoder),i=new Array(r),s=t.readClient();let o=a.k(t.restDecoder);n.set(s,{i:0,refs:i});for(let n=0;n<r;n++){const r=t.readInfo();switch(l.k&r){case 0:{const e=t.readLen();i[n]=new sr(Nt(s,o),e),o+=e;break}case 10:{const e=a.k(t.restDecoder);i[n]=new Ur(Nt(s,o),e),o+=e;break}default:{const c=0==(r&(l.f|l.g)),a=new Tr(Nt(s,o),null,(r&l.g)===l.g?t.readLeftID():null,null,(r&l.f)===l.f?t.readRightID():null,c?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,c&&(r&l.e)===l.e?t.readString():null,Dr(t,r));i[n]=a,o+=a.length}}}}return n})(r,n)),h=s.pendingStructs;if(h){for(const[t,n]of h.missing)if(n<he(s,t)){e=!0;break}if(u){for(const[t,e]of u.missing){const n=h.missing.get(t);(null==n||n>e)&&h.missing.set(t,e)}h.update=We([h.update,u.update])}}else s.pendingStructs=u;const d=nt(r,t,s);if(s.pendingDs){const e=new lt(a.e(s.pendingDs));a.k(e.restDecoder);const n=nt(e,t,s);s.pendingDs=d&&n?We([d,n]):d||n}else s.pendingDs=d;if(e){const e=s.pendingStructs.update;s.pendingStructs=null,yt(t.doc,e)}},n,!1),pt=(t,e,n)=>gt(t,e,n,new ct(t)),yt=(t,e,n,r=lt)=>{const i=a.e(e);gt(i,t,n,new r(i))},wt=(t,e,n)=>yt(t,e,n,ct),mt=(t,e=new Uint8Array([0]),n=new ft)=>{((t,e,n=new Map)=>{_t(t,e.store,n),tt(t,Q(e.store))})(n,t,St(e));const r=[n.toUint8Array()];if(t.store.pendingDs&&r.push(t.store.pendingDs),t.store.pendingStructs&&r.push(ze(t.store.pendingStructs.update,e)),r.length>1){if(n.constructor===ht)return xe(r.map((t,e)=>0===e?t:en(t)));if(n.constructor===ft)return We(r)}return r[0]},Et=(t,e)=>mt(t,e,new ht),bt=t=>{const e=new Map,n=a.k(t.restDecoder);for(let r=0;r<n;r++){const n=a.k(t.restDecoder),r=a.k(t.restDecoder);e.set(n,r)}return e},St=t=>bt(new ot(a.e(t))),vt=(t,e)=>(c.p(t.restEncoder,e.size),i.c(e.entries()).sort((t,e)=>e[0]-t[0]).forEach(([e,n])=>{c.p(t.restEncoder,e),c.p(t.restEncoder,n)}),t),Mt=(t,e=new dt)=>(t instanceof Map?vt(e,t):((t,e)=>{vt(t,ue(e.store))})(e,t),e.toUint8Array()),kt=t=>Mt(t,new ut);class It{constructor(){this.l=[]}}const At=()=>new It,Ct=(t,e)=>t.l.push(e),Tt=(t,e)=>{const n=t.l;n.length;t.l=n.filter(t=>e!==t),t.l.length},Dt=(t,e,n)=>w.a(t.l,[e,n]);class Ot{constructor(t,e){this.client=t,this.clock=e}}const Ut=(t,e)=>t===e||null!==t&&null!==e&&t.client===e.client&&t.clock===e.clock,Nt=(t,e)=>new Ot(t,e),Rt=(t,e)=>{c.p(t,e.client),c.p(t,e.clock)},Lt=t=>Nt(a.k(t),a.k(t)),Pt=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw y.c()},Bt=(t,e)=>{for(;null!==e;){if(e.parent===t)return!0;e=e.parent._item}return!1},xt=t=>{const e=[];let n=t._start;for(;n;)e.push(n),n=n.right;e.filter(t=>!t.deleted).map(t=>t.content)};class Yt{constructor(t,e=t.getMap("users")){const n=new Map;this.yusers=e,this.doc=t,this.clients=new Map,this.dss=n;const r=(t,e)=>{const n=t.get("ds"),r=t.get("ids"),i=t=>this.clients.set(t,e);n.observe(t=>{t.changes.added.forEach(t=>{t.content.getContent().forEach(t=>{t instanceof Uint8Array&&this.dss.set(e,K([this.dss.get(e)||Z(),et(new ot(a.e(t)))]))})})}),this.dss.set(e,K(n.map(t=>et(new ot(a.e(t)))))),r.observe(t=>t.changes.added.forEach(t=>t.content.getContent().forEach(i))),r.forEach(i)};e.observe(t=>{t.keysChanged.forEach(t=>r(e.get(t),t))}),e.forEach(r)}setUserMapping(t,e,n,{filter:r=(()=>!0)}={}){const i=this.yusers;let s=i.get(n);s||(s=new Ln,s.set("ids",new Nn),s.set("ds",new Nn),i.set(n,s)),s.get("ids").push([e]),i.observe(t=>{setTimeout(()=>{const t=i.get(n);if(t!==s){s=t,this.clients.forEach((t,e)=>{n===t&&s.get("ids").push([e])});const e=new ut,r=this.dss.get(n);r&&(tt(e,r),s.get("ds").push([e.toUint8Array()]))}},0)}),t.on("afterTransaction",t=>{setTimeout(()=>{const e=s.get("ds"),n=t.deleteSet;if(t.local&&n.clients.size>0&&r(t,n)){const t=new ut;tt(t,n),e.push([t.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(const[e,n]of this.dss.entries())if(q(n,t))return e;return null}}class Ft{constructor(t,e,n,r=0){this.type=t,this.tname=e,this.item=n,this.assoc=r}}const Ht=t=>{const e={};return t.type&&(e.type=t.type),t.tname&&(e.tname=t.tname),t.item&&(e.item=t.item),null!=t.assoc&&(e.assoc=t.assoc),e},jt=t=>new Ft(null==t.type?null:Nt(t.type.client,t.type.clock),t.tname||null,null==t.item?null:Nt(t.item.client,t.item.clock),null==t.assoc?0:t.assoc);class Vt{constructor(t,e,n=0){this.type=t,this.index=e,this.assoc=n}}const Wt=(t,e,n)=>{let r=null,i=null;return null===t._item?i=Pt(t):r=Nt(t._item.id.client,t._item.id.clock),new Ft(r,i,e,n)},zt=(t,e,n=0)=>{let r=t._start;if(n<0){if(0===e)return Wt(t,null,n);e--}for(;null!==r;){if(!r.deleted&&r.countable){if(r.length>e)return Wt(t,Nt(r.id.client,r.id.clock+e),n);e-=r.length}if(null===r.right&&n<0)return Wt(t,r.lastId,n);r=r.right}return Wt(t,null,n)},Gt=t=>{const e=c.e();return((t,e)=>{const{type:n,tname:r,item:i,assoc:s}=e;if(null!==i)c.p(t,0),Rt(t,i);else if(null!==r)c.l(t,1),c.o(t,r);else{if(null===n)throw y.c();c.l(t,2),Rt(t,n)}c.n(t,s)})(e,t),c.h(e)},Jt=t=>(t=>{let e=null,n=null,r=null;switch(a.k(t)){case 0:r=Lt(t);break;case 1:n=a.j(t);break;case 2:e=Lt(t)}const i=a.f(t)?a.i(t):0;return new Ft(e,n,r,i)})(a.e(t)),qt=(t,e)=>{const n=e.store,r=t.item,i=t.type,s=t.tname,o=t.assoc;let c=null,a=0;if(null!==r){if(he(n,r.client)<=r.clock)return null;const t=Mr(n,r),e=t.item;if(!(e instanceof Tr))return null;if(c=e.parent,null===c._item||!c._item.deleted){a=e.deleted||!e.countable?0:t.diff+(o>=0?0:1);let n=e.left;for(;null!==n;)!n.deleted&&n.countable&&(a+=n.length),n=n.left}}else{if(null!==s)c=e.get(s);else{if(null===i)throw y.c();{if(he(n,i.client)<=i.clock)return null;const{item:t}=Mr(n,i);if(!(t instanceof Tr&&t.content instanceof vr))return null;c=t.content.type}}a=o>=0?c._length:0}return((t,e,n=0)=>new Vt(t,e,n))(c,a,t.assoc)},$t=(t,e)=>t===e||null!==t&&null!==e&&t.tname===e.tname&&Ut(t.item,e.item)&&Ut(t.type,e.type)&&t.assoc===e.assoc;class Kt{constructor(t,e){this.ds=t,this.sv=e}}const Xt=(t,e)=>{const n=t.ds.clients,r=e.ds.clients,i=t.sv,s=e.sv;if(i.size!==s.size||n.size!==r.size)return!1;for(const[t,e]of i.entries())if(s.get(t)!==e)return!1;for(const[t,e]of n.entries()){const n=r.get(t)||[];if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++){const r=e[t],i=n[t];if(r.clock!==i.clock||r.len!==i.len)return!1}}return!0},Zt=(t,e=new dt)=>(tt(e,t.ds),vt(e,t.sv),e.toUint8Array()),Qt=t=>Zt(t,new ut),te=(t,e=new at(a.e(t)))=>new Kt(et(e),bt(e)),ee=t=>te(t,new ot(a.e(t))),ne=(t,e)=>new Kt(t,e),re=ne(Z(),new Map),ie=t=>ne(Q(t.store),ue(t.store)),se=(t,e)=>void 0===e?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!q(e.ds,t.id),oe=(t,e)=>{const n=o.e(t.meta,oe,m.a),r=t.doc.store;n.has(e)||(e.sv.forEach((e,n)=>{e<he(r,n)&&pe(t,Nt(n,e))}),J(t,e.ds,t=>{}),n.add(e))},ce=(t,e,n=new st)=>{if(t.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");const{sv:r,ds:i}=e,s=new ft;return t.transact(e=>{let n=0;r.forEach(t=>{t>0&&n++}),c.p(s.restEncoder,n);for(const[n,i]of r){if(0===i)continue;i<he(t.store,n)&&pe(e,Nt(n,i));const r=t.store.clients.get(n)||[],o=fe(r,i-1);c.p(s.restEncoder,o+1),s.writeClient(n),c.p(s.restEncoder,0);for(let t=0;t<=o;t++)r[t].write(s,0)}tt(s,i)}),yt(n,s.toUint8Array(),"snapshot"),n},ae=(t,e)=>((t,e,n=lt)=>{const r=new n(a.e(e)),i=new Ue(r,!1);for(let e=i.curr;null!==e;e=i.next())if((t.sv.get(e.id.client)||0)<e.id.clock+e.length)return!1;const s=K([t.ds,et(r)]);return rt(t.ds,s)})(t,e,ct);class le{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const ue=t=>{const e=new Map;return t.clients.forEach((t,n)=>{const r=t[t.length-1];e.set(n,r.id.clock+r.length)}),e},he=(t,e)=>{const n=t.clients.get(e);if(void 0===n)return 0;const r=n[n.length-1];return r.id.clock+r.length},de=(t,e)=>{let n=t.clients.get(e.id.client);if(void 0===n)n=[],t.clients.set(e.id.client,n);else{const t=n[n.length-1];if(t.id.clock+t.length!==e.id.clock)throw y.c()}n.push(e)},fe=(t,e)=>{let n=0,r=t.length-1,i=t[r],o=i.id.clock;if(o===e)return r;let c=s.d(e/(o+i.length-1)*r);for(;n<=r;){if(i=t[c],o=i.id.clock,o<=e){if(e<o+i.length)return c;n=c+1}else r=c-1;c=s.d((n+r)/2)}throw y.c()},_e=(t,e)=>{const n=t.clients.get(e.client);return n[fe(n,e.clock)]},ge=(t,e,n)=>{const r=fe(e,n),i=e[r];return i.id.clock<n&&i instanceof Tr?(e.splice(r+1,0,Ir(t,i,n-i.id.clock)),r+1):r},pe=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[ge(t,n,e.clock)]},ye=(t,e,n)=>{const r=e.clients.get(n.client),i=fe(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==sr&&r.splice(i+1,0,Ir(t,s,n.clock-s.id.clock+1)),s},we=(t,e,n,r,i)=>{if(0===r)return;const s=n+r;let o,c=ge(t,e,n);do{o=e[c++],s<o.id.clock+o.length&&ge(t,e,s),i(o)}while(c<e.length&&e[c].id.clock<s)};class me{constructor(t,e,n){this.doc=t,this.deleteSet=new G,this.beforeState=ue(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Ee=(t,e)=>!(0===e.deleteSet.clients.size&&!o.a(e.afterState,(t,n)=>e.beforeState.get(n)!==t))&&($(e.deleteSet),((t,e)=>{_t(t,e.doc.store,e.beforeState)})(t,e),tt(t,e.deleteSet),!0),be=(t,e,n)=>{const r=e._item;(null===r||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&o.e(t.changed,e,m.a).add(n)},Se=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0&&(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n));n=r,r=t[--i-1])n instanceof Tr&&null!==n.parentSub&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);const s=e-i;return s&&t.splice(e+1-s,s),s},ve=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const t=e.clients.get(r);for(let r=i.length-1;r>=0;r--){const s=i[r],o=s.clock+s.len;for(let r=fe(t,s.clock),i=t[r];r<t.length&&i.id.clock<o;i=t[++r]){const i=t[r];if(s.clock+s.len<=i.id.clock)break;i instanceof Tr&&i.deleted&&!i.keep&&n(i)&&i.gc(e,!1)}}}},Me=(t,e)=>{t.clients.forEach((t,n)=>{const r=e.clients.get(n);for(let e=t.length-1;e>=0;e--){const n=t[e];for(let t=s.h(r.length-1,1+fe(r,n.clock+n.len-1)),e=r[t];t>0&&e.id.clock>=n.clock;e=r[t])t-=1+Se(r,t)}})},ke=(t,e,n)=>{ve(t,e,n),Me(t,e)},Ie=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,o=n.deleteSet,c=n._mergeStructs;try{$(o),n.afterState=ue(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((t,e)=>a.push(()=>{null!==e._item&&e._item.deleted||e._callObserver(n,t)})),a.push(()=>{n.changedParentTypes.forEach((t,e)=>{e._dEH.l.length>0&&(null===e._item||!e._item.deleted)&&((t=t.filter(t=>null===t.target._item||!t.target._item.deleted)).forEach(t=>{t.currentTarget=e,t._path=null}),t.sort((t,e)=>t.path.length-e.path.length),Dt(e._dEH,t,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Object(w.a)(a,[]),n._needFormattingCleanup&&qn(n)}finally{r.gc&&ve(o,i,r.gcFilter),Me(o,i),n.afterState.forEach((t,e)=>{const r=n.beforeState.get(e)||0;if(r!==t){const t=i.clients.get(e),n=s.g(fe(t,r),1);for(let e=t.length-1;e>=n;)e-=1+Se(t,e)}});for(let t=c.length-1;t>=0;t--){const{client:e,clock:n}=c[t].id,r=i.clients.get(e),s=fe(r,n);s+1<r.length&&Se(r,s+1)>1||s>0&&Se(r,s)}if(n.local||n.afterState.get(r.clientID)===n.beforeState.get(r.clientID)||(x(R,A,"[yjs] ",C,U,"Changed the client-id because another client seems to be using it."),r.clientID=it()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const t=new ht;Ee(t,n)&&r.emit("update",[t.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const t=new ft;Ee(t,n)&&r.emit("updateV2",[t.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:u}=n;(a.size>0||u.size>0||l.size>0)&&(a.forEach(t=>{t.clientID=r.clientID,null==t.collectionid&&(t.collectionid=r.collectionid),r.subdocs.add(t)}),u.forEach(t=>r.subdocs.delete(t)),r.emit("subdocs",[{loaded:l,added:a,removed:u},r,n]),u.forEach(t=>t.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):Ie(t,e+1)}}},Ae=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;null===t._transaction&&(s=!0,t._transaction=new me(t,n,r),i.push(t._transaction),1===i.length&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const e=t._transaction===i[0];t._transaction=null,e&&Ie(i,0)}}return o};class Ce{constructor(t,e){this.insertions=e,this.deletions=t,this.meta=new Map}}const Te=(t,e,n)=>{J(t,n.deletions,t=>{t instanceof Tr&&e.scope.some(e=>Bt(e,t))&&kr(t,!1)})},De=(t,e,n)=>{let r=null,i=null;const s=t.doc,o=t.scope;if(Ae(s,n=>{for(;e.length>0&&null===r;){const i=s.store,c=e.pop(),a=new Set,l=[];let u=!1;J(n,c.insertions,t=>{if(t instanceof Tr){if(null!==t.redone){let{item:e,diff:r}=Mr(i,t.id);r>0&&(e=pe(n,Nt(e.id.client,e.id.clock+r))),t=e}!t.deleted&&o.some(e=>Bt(e,t))&&l.push(t)}}),J(n,c.deletions,t=>{t instanceof Tr&&o.some(e=>Bt(e,t))&&!q(c.insertions,t.id)&&a.add(t)}),a.forEach(e=>{u=null!==Cr(n,e,a,c.insertions,t.ignoreRemoteMapChanges,t)||u});for(let e=l.length-1;e>=0;e--){const r=l[e];t.deleteFilter(r)&&(r.delete(n),u=!0)}r=u?c:null}n.changed.forEach((t,e)=>{t.has(null)&&e._searchMarker&&(e._searchMarker.length=0)}),i=n},t),null!=r){const e=i.changedParentTypes;t.emit("stack-item-popped",[{stackItem:r,type:n,changedParentTypes:e},t])}return r};class Oe extends r.a{constructor(t,{captureTimeout:e=500,captureTransaction:n=(t=>!0),deleteFilter:r=(()=>!0),trackedOrigins:s=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:c=(i.d(t)?t[0].doc:t.doc)}={}){super(),this.scope=[],this.doc=c,this.addToScope(t),this.deleteFilter=r,s.add(this),this.trackedOrigins=s,this.captureTransaction=n,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=e,this.afterTransactionHandler=t=>{if(!(this.captureTransaction(t)&&this.scope.some(e=>t.changedParentTypes.has(e))&&(this.trackedOrigins.has(t.origin)||t.origin&&this.trackedOrigins.has(t.origin.constructor))))return;const e=this.undoing,n=this.redoing,r=e?this.redoStack:this.undoStack;e?this.stopCapturing():n||this.clear(!1,!0);const i=new G;t.afterState.forEach((e,n)=>{const r=t.beforeState.get(n)||0,s=e-r;s>0&&X(i,n,r,s)});const s=_.a();let o=!1;if(this.lastChange>0&&s-this.lastChange<this.captureTimeout&&r.length>0&&!e&&!n){const e=r[r.length-1];e.deletions=K([e.deletions,t.deleteSet]),e.insertions=K([e.insertions,i])}else r.push(new Ce(t.deleteSet,i)),o=!0;e||n||(this.lastChange=s),J(t,t.deleteSet,t=>{t instanceof Tr&&this.scope.some(e=>Bt(e,t))&&kr(t,!0)});const c=[{stackItem:r[r.length-1],origin:t.origin,type:e?"redo":"undo",changedParentTypes:t.changedParentTypes},this];o?this.emit("stack-item-added",c):this.emit("stack-item-updated",c)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){(t=i.d(t)?t:[t]).forEach(t=>{this.scope.every(e=>e!==t)&&(t.doc!==this.doc&&((...t)=>{B(t),t.unshift(R),Y.forEach(e=>e.print(t))})("[yjs#509] Not same Y.Doc"),this.scope.push(t))})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,e=!0){(t&&this.canUndo()||e&&this.canRedo())&&this.doc.transact(n=>{t&&(this.undoStack.forEach(t=>Te(n,this,t)),this.undoStack=[]),e&&(this.redoStack.forEach(t=>Te(n,this,t)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:e}])})}stopCapturing(){this.lastChange=0}undo(){let t;this.undoing=!0;try{t=De(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){let t;this.redoing=!0;try{t=De(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}class Ue{constructor(t,e){this.gen=function*(t){const e=a.k(t.restDecoder);for(let n=0;n<e;n++){const e=a.k(t.restDecoder),n=t.readClient();let r=a.k(t.restDecoder);for(let i=0;i<e;i++){const e=t.readInfo();if(10===e){const e=a.k(t.restDecoder);yield new Ur(Nt(n,r),e),r+=e}else if(0!=(l.k&e)){const i=0==(e&(l.f|l.g)),s=new Tr(Nt(n,r),null,(e&l.g)===l.g?t.readLeftID():null,null,(e&l.f)===l.f?t.readRightID():null,i?t.readParentInfo()?t.readString():t.readLeftID():null,i&&(e&l.e)===l.e?t.readString():null,Dr(t,e));yield s,r+=s.length}else{const e=t.readLen();yield new sr(Nt(n,r),e),r+=e}}}}(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do{this.curr=this.gen.next().value||null}while(this.filterSkips&&null!==this.curr&&this.curr.constructor===Ur);return this.curr}}const Ne=t=>Re(t,ct),Re=(t,e=lt)=>{const n=[],r=new e(a.e(t)),i=new Ue(r,!1);for(let t=i.curr;null!==t;t=i.next())n.push(t);x("Structs: ",n);const s=et(r);x("DeleteSet: ",s)},Le=t=>Pe(t,ct),Pe=(t,e=lt)=>{const n=[],r=new e(a.e(t)),i=new Ue(r,!1);for(let t=i.curr;null!==t;t=i.next())n.push(t);return{structs:n,ds:et(r)}};class Be{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const xe=t=>We(t,ct,ht),Ye=(t,e=dt,n=lt)=>{const r=new e,i=new Ue(new n(a.e(t)),!1);let s=i.curr;if(null!==s){let t=0,e=s.id.client,n=0!==s.id.clock,o=n?0:s.id.clock+s.length;for(;null!==s;s=i.next())e!==s.id.client&&(0!==o&&(t++,c.p(r.restEncoder,e),c.p(r.restEncoder,o)),e=s.id.client,o=0,n=0!==s.id.clock),s.constructor===Ur&&(n=!0),n||(o=s.id.clock+s.length);0!==o&&(t++,c.p(r.restEncoder,e),c.p(r.restEncoder,o));const a=c.e();return c.p(a,t),c.k(a,r.restEncoder),r.restEncoder=a,r.toUint8Array()}return c.p(r.restEncoder,0),r.toUint8Array()},Fe=t=>Ye(t,ut,ct),He=(t,e=lt)=>{const n=new Map,r=new Map,i=new Ue(new e(a.e(t)),!1);let s=i.curr;if(null!==s){let t=s.id.client,e=s.id.clock;for(n.set(t,e);null!==s;s=i.next())t!==s.id.client&&(r.set(t,e),n.set(s.id.client,s.id.clock),t=s.id.client),e=s.id.clock+s.length;r.set(t,e)}return{from:n,to:r}},je=t=>He(t,ct),Ve=(t,e)=>{if(t.constructor===sr){const{client:n,clock:r}=t.id;return new sr(Nt(n,r+e),t.length-e)}if(t.constructor===Ur){const{client:n,clock:r}=t.id;return new Ur(Nt(n,r+e),t.length-e)}{const n=t,{client:r,clock:i}=n.id;return new Tr(Nt(r,i+e),null,Nt(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},We=(t,e=lt,n=ft)=>{if(1===t.length)return t[0];const r=t.map(t=>new e(a.e(t)));let i=r.map(t=>new Ue(t,!0)),s=null;const o=new n,c=new Be(o);for(;i=i.filter(t=>null!==t.curr),i.sort((t,e)=>{if(t.curr.id.client===e.curr.id.client){const n=t.curr.id.clock-e.curr.id.clock;return 0===n?t.curr.constructor===e.curr.constructor?0:t.curr.constructor===Ur?1:-1:n}return e.curr.id.client-t.curr.id.client}),0!==i.length;){const t=i[0],e=t.curr.id.client;if(null!==s){let n=t.curr,r=!1;for(;null!==n&&n.id.clock+n.length<=s.struct.id.clock+s.struct.length&&n.id.client>=s.struct.id.client;)n=t.next(),r=!0;if(null===n||n.id.client!==e||r&&n.id.clock>s.struct.id.clock+s.struct.length)continue;if(e!==s.struct.id.client)qe(c,s.struct,s.offset),s={struct:n,offset:0},t.next();else if(s.struct.id.clock+s.struct.length<n.id.clock)if(s.struct.constructor===Ur)s.struct.length=n.id.clock+n.length-s.struct.id.clock;else{qe(c,s.struct,s.offset);const t=n.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Ur(Nt(e,s.struct.id.clock+s.struct.length),t),offset:0}}else{const e=s.struct.id.clock+s.struct.length-n.id.clock;e>0&&(s.struct.constructor===Ur?s.struct.length-=e:n=Ve(n,e)),s.struct.mergeWith(n)||(qe(c,s.struct,s.offset),s={struct:n,offset:0},t.next())}}else s={struct:t.curr,offset:0},t.next();for(let n=t.curr;null!==n&&n.id.client===e&&n.id.clock===s.struct.id.clock+s.struct.length&&n.constructor!==Ur;n=t.next())qe(c,s.struct,s.offset),s={struct:n,offset:0}}null!==s&&(qe(c,s.struct,s.offset),s=null),$e(c);const l=r.map(t=>et(t)),u=K(l);return tt(o,u),o.toUint8Array()},ze=(t,e,n=lt,r=ft)=>{const i=St(e),o=new r,c=new Be(o),l=new n(a.e(t)),u=new Ue(l,!1);for(;u.curr;){const t=u.curr,e=t.id.client,n=i.get(e)||0;if(u.curr.constructor!==Ur)if(t.id.clock+t.length>n)for(qe(c,t,s.g(n-t.id.clock,0)),u.next();u.curr&&u.curr.id.client===e;)qe(c,u.curr,0),u.next();else for(;u.curr&&u.curr.id.client===e&&u.curr.id.clock+u.curr.length<=n;)u.next();else u.next()}$e(c);const h=et(l);return tt(o,h),o.toUint8Array()},Ge=(t,e)=>ze(t,e,ct,ht),Je=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:c.h(t.encoder.restEncoder)}),t.encoder.restEncoder=c.e(),t.written=0)},qe=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&Je(t),0===t.written&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),c.p(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},$e=t=>{Je(t);const e=t.encoder.restEncoder;c.p(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];c.p(e,r.written),c.m(e,r.restEncoder)}},Ke=(t,e,n,r)=>{const i=new n(a.e(t)),s=new Ue(i,!1),o=new r,c=new Be(o);for(let t=s.curr;null!==t;t=s.next())qe(c,e(t),0);$e(c);const l=et(i);return tt(o,l),o.toUint8Array()},Xe=({formatting:t=!0,subdocs:e=!0,yxml:n=!0}={})=>{let r=0;const i=o.c(),s=o.c(),c=o.c(),a=o.c();return a.set(null,null),l=>{switch(l.constructor){case sr:case Ur:return l;case Tr:{const u=l,h=u.content;switch(h.constructor){case cr:break;case vr:if(n){const t=h.type;t instanceof tr&&(t.nodeName=o.e(s,t.nodeName,()=>"node-"+r)),t instanceof nr&&(t.hookName=o.e(s,t.hookName,()=>"hook-"+r))}break;case fr:{const t=h;t.arr=t.arr.map(()=>r);break}case or:h.content=new Uint8Array([r]);break;case lr:{const t=h;e&&(t.opts={},t.doc.guid=r+"");break}case ur:h.embed={};break;case hr:{const e=h;t&&(e.key=o.e(c,e.key,()=>r+""),e.value=o.e(a,e.value,()=>({i:r})));break}case dr:{const t=h;t.arr=t.arr.map(()=>r);break}case _r:{const t=h;t.str=F.e(r%10+"",t.str.length);break}default:y.c()}return u.parentSub&&(u.parentSub=o.e(i,u.parentSub,()=>r+"")),r++,l}default:y.c()}}},Ze=(t,e)=>Ke(t,Xe(e),ct,ht),Qe=(t,e)=>Ke(t,Xe(e),lt,ft),tn=t=>Ke(t,w.c,ct,ft),en=t=>Ke(t,w.c,lt,ht),nn="You must not compute changes after the event-handler fired.";class rn{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=sn(this.currentTarget,this.target))}deletes(t){return q(this.transaction.deleteSet,t.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw y.a(nn);const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(n=>{if(null!==n){const r=e._map.get(n);let s,o;if(this.adds(r)){let t=r.left;for(;null!==t&&this.adds(t);)t=t.left;if(this.deletes(r)){if(null===t||!this.deletes(t))return;s="delete",o=i.e(t.content.getContent())}else null!==t&&this.deletes(t)?(s="update",o=i.e(t.content.getContent())):(s="add",o=void 0)}else{if(!this.deletes(r))return;s="delete",o=i.e(r.content.getContent())}t.set(n,{action:s,oldValue:o})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(null===t){if(0===this.transaction.doc._transactionCleanups.length)throw y.a(nn);const e=this.target,n=m.a(),r=m.a(),i=[];t={added:n,deleted:r,delta:i,keys:this.keys};if(this.transaction.changed.get(e).has(null)){let t=null;const s=()=>{t&&i.push(t)};for(let i=e._start;null!==i;i=i.right)i.deleted?this.deletes(i)&&!this.adds(i)&&(null!==t&&void 0!==t.delete||(s(),t={delete:0}),t.delete+=i.length,r.add(i)):this.adds(i)?(null!==t&&void 0!==t.insert||(s(),t={insert:[]}),t.insert=t.insert.concat(i.content.getContent()),n.add(i)):(null!==t&&void 0!==t.retain||(s(),t={retain:0}),t.retain+=i.length);null!==t&&void 0===t.retain&&s()}this._changes=t}return t}}const sn=(t,e)=>{const n=[];for(;null!==e._item&&e!==t;){if(null!==e._item.parentSub)n.unshift(e._item.parentSub);else{let t=0,r=e._item.parent._start;for(;r!==e._item&&null!==r;)r.deleted||t++,r=r.right;n.unshift(t)}e=e._item.parent}return n};let on=0;class cn{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=on++}}const an=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=on++},ln=(t,e)=>{if(null===t._start||0===e||null===t._searchMarker)return null;const n=0===t._searchMarker.length?null:t._searchMarker.reduce((t,n)=>s.a(e-t.index)<s.a(e-n.index)?t:n);let r=t._start,i=0;for(null!==n&&(r=n.p,i=n.index,(t=>{t.timestamp=on++})(n));null!==r.right&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;null!==r.left&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;null!==r.left&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return null!==n&&s.a(n.index-i)<r.parent.length/80?(an(n,r,i),n):((t,e,n)=>{if(t.length>=80){const r=t.reduce((t,e)=>t.timestamp<e.timestamp?t:e);return an(r,e,n),r}{const r=new cn(e,n);return t.push(r),r}})(t._searchMarker,r,i)},un=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let e=i.p;for(e.marker=!1;e&&(e.deleted||!e.countable);)e=e.left,e&&!e.deleted&&e.countable&&(i.index-=e.length);if(null===e||!0===e.marker){t.splice(r,1);continue}i.p=e,e.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=s.g(e,i.index+n))}},hn=t=>{let e=t._start;const n=[];for(;e;)n.push(e),e=e.right;return n},dn=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;o.e(i,t,()=>[]).push(n),null!==t._item;)t=t._item.parent;Dt(r._eH,n,e)};class fn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=At(),this._dEH=At(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw y.b()}clone(){throw y.b()}_write(t){}get _first(){let t=this._start;for(;null!==t&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Ct(this._eH,t)}observeDeep(t){Ct(this._dEH,t)}unobserve(t){Tt(this._eH,t)}unobserveDeep(t){Tt(this._dEH,t)}toJSON(){}}const _n=(t,e,n)=>{e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;null!==s&&r>0;){if(s.countable&&!s.deleted){const t=s.content.getContent();if(t.length<=e)e-=t.length;else{for(let n=e;n<t.length&&r>0;n++)i.push(t[n]),r--;e=0}}s=s.right}return i},gn=t=>{const e=[];let n=t._start;for(;null!==n;){if(n.countable&&!n.deleted){const t=n.content.getContent();for(let n=0;n<t.length;n++)e.push(t[n])}n=n.right}return e},pn=(t,e)=>{const n=[];let r=t._start;for(;null!==r;){if(r.countable&&se(r,e)){const t=r.content.getContent();for(let e=0;e<t.length;e++)n.push(t[e])}r=r.right}return n},yn=(t,e)=>{let n=0,r=t._start;for(;null!==r;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let r=0;r<i.length;r++)e(i[r],n++,t)}r=r.right}},wn=(t,e)=>{const n=[];return yn(t,(r,i)=>{n.push(e(r,i,t))}),n},mn=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(null===n){for(;null!==e&&e.deleted;)e=e.right;if(null===e)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const t=n[r++];return n.length<=r&&(n=null),{done:!1,value:t}}}},En=(t,e)=>{const n=ln(t,e);let r=t._start;for(null!==n&&(r=n.p,e-=n.index);null!==r;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},bn=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,c=s.store,a=null===n?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Tr(Nt(o,he(c,o)),i,i&&i.lastId,a,a&&a.id,e,null,new fr(l)),i.integrate(t,0),l=[])};r.forEach(n=>{if(null===n)l.push(n);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(n);break;default:switch(u(),n.constructor){case Uint8Array:case ArrayBuffer:i=new Tr(Nt(o,he(c,o)),i,i&&i.lastId,a,a&&a.id,e,null,new or(new Uint8Array(n))),i.integrate(t,0);break;case st:i=new Tr(Nt(o,he(c,o)),i,i&&i.lastId,a,a&&a.id,e,null,new lr(n)),i.integrate(t,0);break;default:if(!(n instanceof fn))throw new Error("Unexpected content type in insert operation");i=new Tr(Nt(o,he(c,o)),i,i&&i.lastId,a,a&&a.id,e,null,new vr(n)),i.integrate(t,0)}}}),u()},Sn=()=>y.a("Length exceeded!"),vn=(t,e,n,r)=>{if(n>e._length)throw Sn();if(0===n)return e._searchMarker&&un(e._searchMarker,n,r.length),bn(t,e,null,r);const i=n,s=ln(e,n);let o=e._start;for(null!==s&&(o=s.p,0===(n-=s.index)&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));null!==o;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&pe(t,Nt(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&un(e._searchMarker,i,r.length),bn(t,e,o,r)},Mn=(t,e,n,r)=>{if(0===r)return;const i=n,s=r,o=ln(e,n);let c=e._start;for(null!==o&&(c=o.p,n-=o.index);null!==c&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&pe(t,Nt(c.id.client,c.id.clock+n)),n-=c.length);for(;r>0&&null!==c;)c.deleted||(r<c.length&&pe(t,Nt(c.id.client,c.id.clock+r)),c.delete(t),r-=c.length),c=c.right;if(r>0)throw Sn();e._searchMarker&&un(e._searchMarker,i,-s+r)},kn=(t,e,n)=>{const r=e._map.get(n);void 0!==r&&r.delete(t)},In=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let c;if(null==r)c=new fr([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:c=new fr([r]);break;case Uint8Array:c=new or(r);break;case st:c=new lr(r);break;default:if(!(r instanceof fn))throw new Error("Unexpected content type");c=new vr(r)}new Tr(Nt(o,he(s.store,o)),i,i&&i.lastId,null,null,e,n,c).integrate(t,0)},An=(t,e)=>{const n=t._map.get(e);return void 0===n||n.deleted?void 0:n.content.getContent()[n.length-1]},Cn=t=>{const e={};return t._map.forEach((t,n)=>{t.deleted||(e[n]=t.content.getContent()[t.length-1])}),e},Tn=(t,e)=>{const n=t._map.get(e);return void 0!==n&&!n.deleted},Dn=(t,e,n)=>{let r=t._map.get(e)||null;for(;null!==r&&(!n.sv.has(r.id.client)||r.id.clock>=(n.sv.get(r.id.client)||0));)r=r.left;return null!==r&&se(r,n)?r.content.getContent()[r.length-1]:void 0},On=t=>{return e=t.entries(),n=t=>!t[1].deleted,H(()=>{let t;do{t=e.next()}while(!t.done&&!n(t.value));return t});var e,n};class Un extends rn{constructor(t,e){super(t,e),this._transaction=e}}class Nn extends fn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new Nn;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Nn}clone(){const t=new Nn;return t.insert(0,this.toArray().map(t=>t instanceof fn?t.clone():t)),t}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),dn(this,t,new Un(this,t))}insert(t,e){null!==this.doc?Ae(this.doc,n=>{vn(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){null!==this.doc?Ae(this.doc,e=>{((t,e,n)=>{let r=(e._searchMarker||[]).reduce((t,e)=>e.index>t.index?e:t,{index:0,p:e._start}).p;if(r)for(;r.right;)r=r.right;bn(t,e,r,n)})(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){null!==this.doc?Ae(this.doc,n=>{Mn(n,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return En(this,t)}toArray(){return gn(this)}slice(t=0,e=this.length){return _n(this,t,e)}toJSON(){return this.map(t=>t instanceof fn?t.toJSON():t)}map(t){return wn(this,t)}forEach(t){yn(this,t)}[Symbol.iterator](){return mn(this)}_write(t){t.writeTypeRef(pr)}}class Rn extends rn{constructor(t,e,n){super(t,e),this.keysChanged=n}}class Ln extends fn{constructor(t){super(),this._prelimContent=null,this._prelimContent=void 0===t?new Map:new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((t,e)=>{this.set(e,t)}),this._prelimContent=null}_copy(){return new Ln}clone(){const t=new Ln;return this.forEach((e,n)=>{t.set(n,e instanceof fn?e.clone():e)}),t}_callObserver(t,e){dn(this,t,new Rn(this,t,e))}toJSON(){const t={};return this._map.forEach((e,n)=>{if(!e.deleted){const r=e.content.getContent()[e.length-1];t[n]=r instanceof fn?r.toJSON():r}}),t}get size(){return[...On(this._map)].length}keys(){return j(On(this._map),t=>t[0])}values(){return j(On(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return j(On(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((e,n)=>{e.deleted||t(e.content.getContent()[e.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(t){null!==this.doc?Ae(this.doc,e=>{kn(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return null!==this.doc?Ae(this.doc,n=>{In(n,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return An(this,t)}has(t){return Tn(this,t)}clear(){null!==this.doc?Ae(this.doc,t=>{this.forEach((function(e,n,r){kn(t,r,n)}))}):this._prelimContent.clear()}_write(t){t.writeTypeRef(yr)}}const Pn=(t,e)=>t===e||"object"==typeof t&&"object"==typeof e&&t&&e&&V.b(t,e);class Bn{constructor(t,e,n,r){this.left=t,this.right=e,this.index=n,this.currentAttributes=r}forward(){switch(null===this.right&&y.c(),this.right.content.constructor){case hr:this.right.deleted||Hn(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length)}this.left=this.right,this.right=this.right.right}}const xn=(t,e,n)=>{for(;null!==e.right&&n>0;){switch(e.right.content.constructor){case hr:e.right.deleted||Hn(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&pe(t,Nt(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length)}e.left=e.right,e.right=e.right.right}return e},Yn=(t,e,n)=>{const r=new Map,i=ln(e,n);if(i){const e=new Bn(i.p.left,i.p,i.index,r);return xn(t,e,n-i.index)}{const i=new Bn(null,e._start,0,r);return xn(t,i,n)}},Fn=(t,e,n,r)=>{for(;null!==n.right&&(!0===n.right.deleted||n.right.content.constructor===hr&&Pn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((r,o)=>{const c=n.left,a=n.right,l=new Tr(Nt(s,he(i.store,s)),c,c&&c.lastId,a,a&&a.id,e,null,new hr(o,r));l.integrate(t,0),n.right=l,n.forward()})},Hn=(t,e)=>{const{key:n,value:r}=e;null===r?t.delete(n):t.set(n,r)},jn=(t,e)=>{for(;null!==t.right&&(t.right.deleted||t.right.content.constructor===hr&&Pn(e[t.right.content.key]||null,t.right.content.value));)t.forward()},Vn=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const c in r){const a=r[c],l=n.currentAttributes.get(c)||null;if(!Pn(l,a)){o.set(c,l);const{left:r,right:u}=n;n.right=new Tr(Nt(s,he(i.store,s)),r,r&&r.lastId,u,u&&u.id,e,null,new hr(c,a)),n.right.integrate(t,0),n.forward()}}return o},Wn=(t,e,n,r,i)=>{n.currentAttributes.forEach((t,e)=>{void 0===i[e]&&(i[e]=null)});const s=t.doc,o=s.clientID;jn(n,i);const c=Vn(t,e,n,i),a=r.constructor===String?new _r(r):r instanceof fn?new vr(r):new ur(r);let{left:l,right:u,index:h}=n;e._searchMarker&&un(e._searchMarker,n.index,a.getLength()),u=new Tr(Nt(o,he(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,a),u.integrate(t,0),n.right=u,n.index=h,n.forward(),Fn(t,e,n,c)},zn=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;jn(n,i);const c=Vn(t,e,n,i);t:for(;null!==n.right&&(r>0||c.size>0&&(n.right.deleted||n.right.content.constructor===hr));){if(!n.right.deleted)switch(n.right.content.constructor){case hr:{const{key:e,value:s}=n.right.content,o=i[e];if(void 0!==o){if(Pn(o,s))c.delete(e);else{if(0===r)break t;c.set(e,s)}n.right.delete(t)}else n.currentAttributes.set(e,s);break}default:r<n.right.length&&pe(t,Nt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length}n.forward()}if(r>0){let i="";for(;r>0;r--)i+="\n";n.right=new Tr(Nt(o,he(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new _r(i)),n.right.integrate(t,0),n.forward()}Fn(t,e,n,c)},Gn=(t,e,n,r,i)=>{let s=e;const c=o.c();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===hr){const t=s.content;c.set(t.key,t)}s=s.right}let a=0,l=!1;for(;e!==s;){if(n===e&&(l=!0),!e.deleted){const n=e.content;switch(n.constructor){case hr:{const{key:s,value:o}=n,u=r.get(s)||null;c.get(s)===n&&u!==o||(e.delete(t),a++,l||(i.get(s)||null)!==o||u===o||(null===u?i.delete(s):i.set(s,u))),l||e.deleted||Hn(i,n);break}}}e=e.right}return a},Jn=t=>{let e=0;return Ae(t.doc,n=>{let r=t._start,i=t._start,s=o.c();const c=o.b(s);for(;i;){if(!1===i.deleted)switch(i.content.constructor){case hr:Hn(c,i.content);break;default:e+=Gn(n,r,i,s,c),s=o.b(c),r=i}i=i.right}}),e},qn=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&we(t,n.store.clients.get(r),s,i,t=>{t.deleted||t.content.constructor!==hr||t.constructor===sr||e.add(t.parent)})}Ae(n,n=>{J(t,t.deleteSet,t=>{if(t instanceof sr||!t.parent._hasFormatting||e.has(t.parent))return;const r=t.parent;t.content.constructor===hr?e.add(r):((t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===hr){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}})(n,t)});for(const t of e)Jn(t)})},$n=(t,e,n)=>{const r=n,i=o.b(e.currentAttributes),s=e.right;for(;n>0&&null!==e.right;){if(!1===e.right.deleted)switch(e.right.content.constructor){case vr:case ur:case _r:n<e.right.length&&pe(t,Nt(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t)}e.forward()}s&&Gn(t,s,e.right,i,e.currentAttributes);const c=(e.left||e.right).parent;return c._searchMarker&&un(c._searchMarker,e.index,-r+n),e};class Kn extends rn{constructor(t,e,n){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(t=>{null===t?this.childListChanged=!0:this.keysChanged.add(t)})}get changes(){if(null===this._changes){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(null===this._delta){const t=this.target.doc,e=[];Ae(t,t=>{const n=new Map,r=new Map;let i=this.target._start,s=null;const o={};let c="",a=0,l=0;const u=()=>{if(null!==s){let t=null;switch(s){case"delete":l>0&&(t={delete:l}),l=0;break;case"insert":("object"==typeof c||c.length>0)&&(t={insert:c},n.size>0&&(t.attributes={},n.forEach((e,n)=>{null!==e&&(t.attributes[n]=e)}))),c="";break;case"retain":a>0&&(t={retain:a},V.e(o)||(t.attributes=V.a({},o))),a=0}t&&e.push(t),s=null}};for(;null!==i;){switch(i.content.constructor){case vr:case ur:this.adds(i)?this.deletes(i)||(u(),s="insert",c=i.content.getContent()[0],u()):this.deletes(i)?("delete"!==s&&(u(),s="delete"),l+=1):i.deleted||("retain"!==s&&(u(),s="retain"),a+=1);break;case _r:this.adds(i)?this.deletes(i)||("insert"!==s&&(u(),s="insert"),c+=i.content.str):this.deletes(i)?("delete"!==s&&(u(),s="delete"),l+=i.length):i.deleted||("retain"!==s&&(u(),s="retain"),a+=i.length);break;case hr:{const{key:e,value:c}=i.content;if(this.adds(i)){if(!this.deletes(i)){const a=n.get(e)||null;Pn(a,c)?null!==c&&i.delete(t):("retain"===s&&u(),Pn(c,r.get(e)||null)?delete o[e]:o[e]=c)}}else if(this.deletes(i)){r.set(e,c);const t=n.get(e)||null;Pn(t,c)||("retain"===s&&u(),o[e]=t)}else if(!i.deleted){r.set(e,c);const n=o[e];void 0!==n&&(Pn(n,c)?null!==n&&i.delete(t):("retain"===s&&u(),null===c?delete o[e]:o[e]=c))}i.deleted||("insert"===s&&u(),Hn(n,i.content));break}}i=i.right}for(u();e.length>0;){const t=e[e.length-1];if(void 0===t.retain||void 0!==t.attributes)break;e.pop()}}),this._delta=e}return this._delta}}class Xn extends fn{constructor(t){super(),this._pending=void 0!==t?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(t=>t())}catch(t){}this._pending=null}_copy(){return new Xn}clone(){const t=new Xn;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const n=new Kn(this,t,e);dn(this,t,n),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",e=this._start;for(;null!==e;)!e.deleted&&e.countable&&e.content.constructor===_r&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){null!==this.doc?Ae(this.doc,n=>{const r=new Bn(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const s=t[i];if(void 0!==s.insert){const o=e||"string"!=typeof s.insert||i!==t.length-1||null!==r.right||"\n"!==s.insert.slice(-1)?s.insert:s.insert.slice(0,-1);("string"!=typeof o||o.length>0)&&Wn(n,this,r,o,s.attributes||{})}else void 0!==s.retain?zn(n,this,r,s.retain,s.attributes||{}):void 0!==s.delete&&$n(n,r,s.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,n){const r=[],i=new Map,s=this.doc;let o="",c=this._start;function a(){if(o.length>0){const t={};let e=!1;i.forEach((n,r)=>{e=!0,t[r]=n});const n={insert:o};e&&(n.attributes=t),r.push(n),o=""}}const l=()=>{for(;null!==c;){if(se(c,t)||void 0!==e&&se(c,e))switch(c.content.constructor){case _r:{const r=i.get("ychange");void 0===t||se(c,t)?void 0===e||se(c,e)?void 0!==r&&(a(),i.delete("ychange")):void 0!==r&&r.user===c.id.client&&"added"===r.type||(a(),i.set("ychange",n?n("added",c.id):{type:"added"})):void 0!==r&&r.user===c.id.client&&"removed"===r.type||(a(),i.set("ychange",n?n("removed",c.id):{type:"removed"})),o+=c.content.str;break}case vr:case ur:{a();const t={insert:c.content.getContent()[0]};if(i.size>0){const e={};t.attributes=e,i.forEach((t,n)=>{e[n]=t})}r.push(t);break}case hr:se(c,t)&&(a(),Hn(i,c.content))}c=c.right}a()};return t||e?Ae(s,n=>{t&&oe(n,t),e&&oe(n,e),l()},"cleanup"):l(),r}insert(t,e,n){if(e.length<=0)return;const r=this.doc;null!==r?Ae(r,r=>{const i=Yn(r,this,t);n||(n={},i.currentAttributes.forEach((t,e)=>{n[e]=t})),Wn(r,this,i,e,n)}):this._pending.push(()=>this.insert(t,e,n))}insertEmbed(t,e,n={}){const r=this.doc;null!==r?Ae(r,r=>{const i=Yn(r,this,t);Wn(r,this,i,e,n)}):this._pending.push(()=>this.insertEmbed(t,e,n))}delete(t,e){if(0===e)return;const n=this.doc;null!==n?Ae(n,n=>{$n(n,Yn(n,this,t),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,n){if(0===e)return;const r=this.doc;null!==r?Ae(r,r=>{const i=Yn(r,this,t);null!==i.right&&zn(r,this,i,e,n)}):this._pending.push(()=>this.format(t,e,n))}removeAttribute(t){null!==this.doc?Ae(this.doc,e=>{kn(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){null!==this.doc?Ae(this.doc,n=>{In(n,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return An(this,t)}getAttributes(){return Cn(this)}_write(t){t.writeTypeRef(wr)}}class Zn{constructor(t,e=(()=>!0)){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(null!==t&&(!this._firstCall||t.deleted||!this._filter(e)))do{if(e=t.content.type,t.deleted||e.constructor!==tr&&e.constructor!==Qn||null===e._start)for(;null!==t;){if(null!==t.right){t=t.right;break}t=t.parent===this._root?null:t.parent._item}else t=e._start}while(null!==t&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,null===t?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Qn extends fn{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Qn}clone(){const t=new Qn;return t.insert(0,this.toArray().map(t=>t instanceof fn?t.clone():t)),t}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(t){return new Zn(this,t)}querySelector(t){t=t.toUpperCase();const e=new Zn(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t).next();return e.done?null:e.value}querySelectorAll(t){return t=t.toUpperCase(),i.c(new Zn(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){dn(this,t,new er(this,e,t))}toString(){return wn(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},n){const r=t.createDocumentFragment();return void 0!==n&&n._createAssociation(r,this),yn(this,i=>{r.insertBefore(i.toDOM(t,e,n),null)}),r}insert(t,e){null!==this.doc?Ae(this.doc,n=>{vn(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(null!==this.doc)Ae(this.doc,n=>{const r=t&&t instanceof fn?t._item:t;bn(n,this,r,e)});else{const n=this._prelimContent,r=null===t?0:n.findIndex(e=>e===t)+1;if(0===r&&null!==t)throw y.a("Reference item not found");n.splice(r,0,...e)}}delete(t,e=1){null!==this.doc?Ae(this.doc,n=>{Mn(n,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return gn(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return En(this,t)}slice(t=0,e=this.length){return _n(this,t,e)}forEach(t){yn(this,t)}_write(t){t.writeTypeRef(Er)}}class tr extends Qn{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((t,e)=>{this.setAttribute(e,t)}),this._prelimAttrs=null}_copy(){return new tr(this.nodeName)}clone(){const t=new tr(this.nodeName),e=this.getAttributes();return V.c(e,(e,n)=>{"string"==typeof e&&t.setAttribute(n,e)}),t.insert(0,this.toArray().map(t=>t instanceof fn?t.clone():t)),t}toString(){const t=this.getAttributes(),e=[],n=[];for(const e in t)n.push(e);n.sort();const r=n.length;for(let i=0;i<r;i++){const r=n[i];e.push(r+'="'+t[r]+'"')}const i=this.nodeName.toLocaleLowerCase();return`<${i}${e.length>0?" "+e.join(" "):""}>${super.toString()}</${i}>`}removeAttribute(t){null!==this.doc?Ae(this.doc,e=>{kn(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){null!==this.doc?Ae(this.doc,n=>{In(n,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return An(this,t)}hasAttribute(t){return Tn(this,t)}getAttributes(){return Cn(this)}toDOM(t=document,e={},n){const r=t.createElement(this.nodeName),i=this.getAttributes();for(const t in i){const e=i[t];"string"==typeof e&&r.setAttribute(t,e)}return yn(this,i=>{r.appendChild(i.toDOM(t,e,n))}),void 0!==n&&n._createAssociation(r,this),r}_write(t){t.writeTypeRef(mr),t.writeKey(this.nodeName)}}class er extends rn{constructor(t,e,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(t=>{null===t?this.childListChanged=!0:this.attributesChanged.add(t)})}}class nr extends Ln{constructor(t){super(),this.hookName=t}_copy(){return new nr(this.hookName)}clone(){const t=new nr(this.hookName);return this.forEach((e,n)=>{t.set(n,e)}),t}toDOM(t=document,e={},n){const r=e[this.hookName];let i;return i=void 0!==r?r.createDom(this):document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),void 0!==n&&n._createAssociation(i,this),i}_write(t){t.writeTypeRef(br),t.writeKey(this.hookName)}}class rr extends Xn{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new rr}clone(){const t=new rr;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,n){const r=t.createTextNode(this.toString());return void 0!==n&&n._createAssociation(r,this),r}toString(){return this.toDelta().map(t=>{const e=[];for(const n in t.attributes){const r=[];for(const e in t.attributes[n])r.push({key:e,value:t.attributes[n][e]});r.sort((t,e)=>t.key<e.key?-1:1),e.push({nodeName:n,attrs:r})}e.sort((t,e)=>t.nodeName<e.nodeName?-1:1);let n="";for(let t=0;t<e.length;t++){const r=e[t];n+="<"+r.nodeName;for(let t=0;t<r.attrs.length;t++){const e=r.attrs[t];n+=` ${e.key}="${e.value}"`}n+=">"}n+=t.insert;for(let t=e.length-1;t>=0;t--)n+=`</${e[t].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Sr)}}class ir{constructor(t,e){this.id=t,this.length=e}get deleted(){throw y.b()}mergeWith(t){return!1}write(t,e,n){throw y.b()}integrate(t,e){throw y.b()}}class sr extends ir{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),de(t.doc.store,this)}write(t,e){t.writeInfo(0),t.writeLen(this.length-e)}getMissing(t,e){return null}}class or{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new or(this.content)}splice(t){throw y.b()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}class cr{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new cr(this.len)}splice(t){const e=new cr(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){X(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const ar=(t,e)=>new st({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class lr{constructor(t){t._item,this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),null!==t.meta&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new lr(ar(this.doc.guid,this.opts))}splice(t){throw y.b()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}class ur{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ur(this.embed)}splice(t){throw y.b()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}class hr{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new hr(this.key,this.value)}splice(t){throw y.b()}mergeWith(t){return!1}integrate(t,e){const n=e.parent;n._searchMarker=null,n._hasFormatting=!0}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}class dr{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new dr(this.arr)}splice(t){const e=new dr(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let r=e;r<n;r++){const e=this.arr[r];t.writeString(void 0===e?"undefined":JSON.stringify(e))}}getRef(){return 2}}class fr{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new fr(this.arr)}splice(t){const e=new fr(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let r=e;r<n;r++){const e=this.arr[r];t.writeAny(e)}}getRef(){return 8}}class _r{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new _r(this.str)}splice(t){const e=new _r(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"�",e.str="�"+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(0===e?this.str:this.str.slice(e))}getRef(){return 4}}const gr=[t=>new Nn,t=>new Ln,t=>new Xn,t=>new tr(t.readKey()),t=>new Qn,t=>new nr(t.readKey()),t=>new rr],pr=0,yr=1,wr=2,mr=3,Er=4,br=5,Sr=6;class vr{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new vr(this.type._copy())}splice(t){throw y.b()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;null!==e;)e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(e=>{e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;null!==e;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(e=>{for(;null!==e;)e.gc(t,!0),e=e.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Mr=(t,e)=>{let n,r=e,i=0;do{i>0&&(r=Nt(r.client,r.clock+i)),n=_e(t,r),i=r.clock-n.id.clock,r=n.redone}while(null!==r&&n instanceof Tr);return{item:n,diff:i}},kr=(t,e)=>{for(;null!==t&&t.keep!==e;)t.keep=e,t=t.parent._item},Ir=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new Tr(Nt(r,i+n),e,Nt(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),null!==e.redone&&(s.redone=Nt(e.redone.client,e.redone.clock+n)),e.right=s,null!==s.right&&(s.right.left=s),t._mergeStructs.push(s),null!==s.parentSub&&null===s.right&&s.parent._map.set(s.parentSub,s),e.length=n,s},Ar=(t,e)=>i.g(t,t=>q(t.deletions,e)),Cr=(t,e,n,r,i,s)=>{const o=t.doc,c=o.store,a=o.clientID,l=e.redone;if(null!==l)return pe(t,l);let u,h=e.parent._item,d=null;if(null!==h&&!0===h.deleted){if(null===h.redone&&(!n.has(h)||null===Cr(t,h,n,r,i,s)))return null;for(;null!==h.redone;)h=pe(t,h.redone)}const f=null===h?e.parent:h.content.type;if(null===e.parentSub){for(d=e.left,u=e;null!==d;){let e=d;for(;null!==e&&e.parent._item!==h;)e=null===e.redone?null:pe(t,e.redone);if(null!==e&&e.parent._item===h){d=e;break}d=d.left}for(;null!==u;){let e=u;for(;null!==e&&e.parent._item!==h;)e=null===e.redone?null:pe(t,e.redone);if(null!==e&&e.parent._item===h){u=e;break}u=u.right}}else if(u=null,e.right&&!i){for(d=e;null!==d&&null!==d.right&&(d.right.redone||q(r,d.right.id)||Ar(s.undoStack,d.right.id)||Ar(s.redoStack,d.right.id));)for(d=d.right;d.redone;)d=pe(t,d.redone);if(d&&null!==d.right)return null}else d=f._map.get(e.parentSub)||null;const _=he(c,a),g=Nt(a,_),p=new Tr(g,d,d&&d.lastId,u,u&&u.id,f,e.parentSub,e.content.copy());return e.redone=g,kr(p,!0),p.integrate(t,0),p};class Tr extends ir{constructor(t,e,n,r,i,s,o,c){super(t,c.getLength()),this.origin=n,this.left=e,this.right=r,this.rightOrigin=i,this.parent=s,this.parentSub=o,this.redone=null,this.content=c,this.info=this.content.isCountable()?l.b:0}set marker(t){(this.info&l.d)>0!==t&&(this.info^=l.d)}get marker(){return(this.info&l.d)>0}get keep(){return(this.info&l.a)>0}set keep(t){this.keep!==t&&(this.info^=l.a)}get countable(){return(this.info&l.b)>0}get deleted(){return(this.info&l.c)>0}set deleted(t){this.deleted!==t&&(this.info^=l.c)}markDeleted(){this.info|=l.c}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=he(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=he(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ot&&this.id.client!==this.parent.client&&this.parent.clock>=he(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=ye(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=pe(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===sr||this.right&&this.right.constructor===sr)this.parent=null;else if(this.parent){if(this.parent.constructor===Ot){const t=_e(e,this.parent);t.constructor===sr?this.parent=null:this.parent=t.content.type}}else this.left&&this.left.constructor===Tr&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Tr&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=ye(t,t.doc.store,Nt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let e,n=this.left;if(null!==n)e=n.right;else if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&null!==e.left;)e=e.left;else e=this.parent._start;const r=new Set,i=new Set;for(;null!==e&&e!==this.right;){if(i.add(e),r.add(e),Ut(this.origin,e.origin)){if(e.id.client<this.id.client)n=e,r.clear();else if(Ut(this.rightOrigin,e.rightOrigin))break}else{if(null===e.origin||!i.has(_e(t.doc.store,e.origin)))break;r.has(_e(t.doc.store,e.origin))||(n=e,r.clear())}e=e.right}this.left=n}if(null!==this.left){const t=this.left.right;this.right=t,this.left.right=this}else{let t;if(null!==this.parentSub)for(t=this.parent._map.get(this.parentSub)||null;null!==t&&null!==t.left;)t=t.left;else t=this.parent._start,this.parent._start=this;this.right=t}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(t)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),de(t.doc.store,this),this.content.integrate(t,this),be(t,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(t)}else new sr(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;null!==t&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;null!==t&&t.deleted;)t=t.left;return t}get lastId(){return 1===this.length?this.id:Nt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ut(t.origin,this.lastId)&&this.right===t&&Ut(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&null===this.redone&&null===t.redone&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(e=>{e.p===t&&(e.p=this,!this.deleted&&this.countable&&(e.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,null!==this.right&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&null===this.parentSub&&(e._length-=this.length),this.markDeleted(),X(t.deleteSet,this.id.client,this.id.clock,this.length),be(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw y.c();this.content.gc(t),e?((t,e,n)=>{const r=t.clients.get(e.id.client);r[fe(r,e.id.clock)]=n})(t,this,new sr(this.id,this.length)):this.content=new cr(this.length)}write(t,e){const n=e>0?Nt(this.id.client,this.id.clock+e-1):this.origin,r=this.rightOrigin,i=this.parentSub,s=this.content.getRef()&l.k|(null===n?0:l.g)|(null===r?0:l.f)|(null===i?0:l.e);if(t.writeInfo(s),null!==n&&t.writeLeftID(n),null!==r&&t.writeRightID(r),null===n&&null===r){const e=this.parent;if(void 0!==e._item){const n=e._item;if(null===n){const n=Pt(e);t.writeParentInfo(!0),t.writeString(n)}else t.writeParentInfo(!1),t.writeLeftID(n.id)}else e.constructor===String?(t.writeParentInfo(!0),t.writeString(e)):e.constructor===Ot?(t.writeParentInfo(!1),t.writeLeftID(e)):y.c();null!==i&&t.writeString(i)}this.content.write(t,e)}}const Dr=(t,e)=>Or[e&l.k](t),Or=[()=>{y.c()},t=>new cr(t.readLen()),t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const e=t.readString();"undefined"===e?n.push(void 0):n.push(JSON.parse(e))}return new dr(n)},t=>new or(t.readBuf()),t=>new _r(t.readString()),t=>new ur(t.readJSON()),t=>new hr(t.readKey(),t.readJSON()),t=>new vr(gr[t.readTypeRef()](t)),t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new fr(n)},t=>new lr(ar(t.readString(),t.readAny())),()=>{y.c()}];class Ur extends ir{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){y.c()}write(t,e){t.writeInfo(10),c.p(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const Nr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};Nr["__ $YJS$ __"],Nr["__ $YJS$ __"]=!0},418:function(t,e,n){"use strict";n.d(e,"a",(function(){return l})),n.d(e,"d",(function(){return u})),n.d(e,"c",(function(){return h})),n.d(e,"b",(function(){return d}));var r=n(3),i=n(8),s=n(175),o=n(27),c=n(466),a=n(259);class l extends c.a{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const t=s.a();null!==this.getLocalState()&&15e3<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const e=[];this.meta.forEach((n,r)=>{r!==this.clientID&&3e4<=t-n.lastUpdated&&this.states.has(r)&&e.push(r)}),e.length>0&&u(this,e,"timeout")},o.d(3e3)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const e=this.clientID,n=this.meta.get(e),r=void 0===n?0:n.clock+1,i=this.states.get(e);null===t?this.states.delete(e):this.states.set(e,t),this.meta.set(e,{clock:r,lastUpdated:s.a()});const o=[],c=[],l=[],u=[];null===t?u.push(e):null==i?null!=t&&o.push(e):(c.push(e),a.b(i,t)||l.push(e)),(o.length>0||l.length>0||u.length>0)&&this.emit("change",[{added:o,updated:l,removed:u},"local"]),this.emit("update",[{added:o,updated:c,removed:u},"local"])}setLocalStateField(t,e){const n=this.getLocalState();null!==n&&this.setLocalState({...n,[t]:e})}getStates(){return this.states}}const u=(t,e,n)=>{const r=[];for(let n=0;n<e.length;n++){const i=e[n];if(t.states.has(i)){if(t.states.delete(i),i===t.clientID){const e=t.meta.get(i);t.meta.set(i,{clock:e.clock+1,lastUpdated:s.a()})}r.push(i)}}r.length>0&&(t.emit("change",[{added:[],updated:[],removed:r},n]),t.emit("update",[{added:[],updated:[],removed:r},n]))},h=(t,e,n=t.states)=>{const i=e.length,s=r.e();r.p(s,i);for(let o=0;o<i;o++){const i=e[o],c=n.get(i)||null,a=t.meta.get(i).clock;r.p(s,i),r.p(s,a),r.o(s,JSON.stringify(c))}return r.h(s)},d=(t,e,n)=>{const r=i.e(e),o=s.a(),c=[],l=[],u=[],h=[],d=i.k(r);for(let e=0;e<d;e++){const e=i.k(r);let n=i.k(r);const s=JSON.parse(i.j(r)),d=t.meta.get(e),f=t.states.get(e),_=void 0===d?0:d.clock;(_<n||_===n&&null===s&&t.states.has(e))&&(null===s?e===t.clientID&&null!=t.getLocalState()?n++:t.states.delete(e):t.states.set(e,s),t.meta.set(e,{clock:n,lastUpdated:o}),void 0===d&&null!==s?c.push(e):void 0!==d&&null===s?h.push(e):null!==s&&(a.b(s,f)||u.push(e),l.push(e)))}(c.length>0||u.length>0||h.length>0)&&t.emit("change",[{added:c,updated:u,removed:h},n]),(c.length>0||l.length>0||h.length>0)&&t.emit("update",[{added:c,updated:l,removed:h},n])}},441:function(t,e,n){"use strict";e.__esModule=!0;var r=e.PLUGIN_NAME="collaboration";e.TYPE={LAST_USER_ID:"lastUserId",IS_ALONE:"isAlone",SERVER_INFO:"serverInfo",SUB:"sub"},e.SUBDOC_ROOT_NAME={DEFAULT:"",META:"meta"},e.SUBDOC_META_TYPE={USER:"user"},e.SUB_DOC_PREFIX="__sub__",e.EVENT_TYPE={ON_SYNC:"onSync",ON_CLOSE:"onClose",USER_CHANGED:"userChanged",USER_INFO_CHANGED:"userInfoChanged",DOCUMENT_UPDATED:"documentUpdated"},e.DIFF_ERROR_MESSAGE={NO_TARGET_IDS:"No target ids",HAS_DELETED_MODEL:"Has deleted model",CCA_IS_BODY:"Common acestor is body",BACKUP_NOT_FOUND:"Backup not found",MODEL_PATH_CHANGED:"Model path changed"},e.AWARENESS_PING_INTERVAL=25e3,e.DEFAULT_SPLIT_CHUNK_SIZE=300,e.DEFAULT_EDIT_SYNC_INTERVAL=300,e.AWARENESS_WORKER_DATA={START:"start",PING:"ping"},e.BUTTON_NAME={COLLABORATOR:"collaborator",UPDATE_HISTORY:"updateHistory"},e.DIALOG_NAME={HISTORY:r+"_history"},e.NAME_PREFIX="Anonymous",e.ICON_COUNT=3,e.USER_COUNT=9,e.DEFAULT_HISTORY_MAXIMUM=300,e.DEFAULT_HISTORY_DEBOUNCE_TIME=300},442:function(t,e,n){"use strict";n.d(e,"b",(function(){return u})),n.d(e,"c",(function(){return h})),n.d(e,"a",(function(){return d}));var r=n(31),i=n(235),s=n(745),o=n(746);const c=new Map;const a="undefined"==typeof BroadcastChannel?class{constructor(t){this.room=t,this.onmessage=null,this._onChange=e=>e.key===t&&null!==this.onmessage&&this.onmessage({data:s.c(e.newValue||"")}),o.b(this._onChange)}postMessage(t){o.c.setItem(this.room,s.d(s.b(t)))}close(){o.a(this._onChange)}}:BroadcastChannel,l=t=>r.e(c,t,()=>{const e=i.a(),n=new a(t);return n.onmessage=t=>e.forEach(e=>e(t.data,"broadcastchannel")),{bc:n,subs:e}}),u=(t,e)=>(l(t).subs.add(e),e),h=(t,e)=>{const n=l(t),r=n.subs.delete(e);return r&&0===n.subs.size&&(n.bc.close(),c.delete(t)),r},d=(t,e,n=null)=>{const r=l(t);r.bc.postMessage(e),r.subs.forEach(t=>t(e,n))}},466:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(31),i=n(235),s=n(73);class o{constructor(){this._observers=r.c()}on(t,e){r.e(this._observers,t,i.a).add(e)}once(t,e){const n=(...r)=>{this.off(t,n),e(...r)};this.on(t,n)}off(t,e){const n=this._observers.get(t);void 0!==n&&(n.delete(e),0===n.size&&this._observers.delete(t))}emit(t,e){return s.c((this._observers.get(t)||r.c()).values()).forEach(t=>t(...e))}destroy(){this._observers=r.c()}}},467:function(t,e,n){"use strict";(function(t){n.d(e,"b",(function(){return l})),n.d(e,"a",(function(){return _})),n.d(e,"c",(function(){return y}));var r=n(31),i=n(174),s=n(916),o=n(746),c=n(259);const a=void 0!==t&&t.release&&/node|io\.js/.test(t.release.name)&&"[object process]"===Object.prototype.toString.call(void 0!==t?t:0),l="undefined"!=typeof window&&"undefined"!=typeof document&&!a;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let u;const h=[],d=()=>{if(void 0===u)if(a){u=r.c();const e=t.argv;let n=null;for(let t=0;t<e.length;t++){const r=e[t];"-"===r[0]?(null!==n&&u.set(n,""),n=r):null!==n?(u.set(n,r),n=null):h.push(r)}null!==n&&u.set(n,"")}else"object"==typeof location?(u=r.c(),(location.search||"?").slice(1).split("&").forEach(t=>{if(0!==t.length){const[e,n]=t.split("=");u.set("--"+i.c(e,"-"),n),u.set("-"+i.c(e,"-"),n)}})):u=r.c();return u},f=t=>d().has(t),_=e=>a?s.a(t.env[e.toUpperCase()]):s.a(o.c.getItem(e));f("--"+(g="production"))||_(g);var g;const p=a&&c.d(t.env.FORCE_COLOR,["true","1","2"]),y=!f("no-colors")&&(!a||t.stdout.isTTY||p)&&(!a||f("color")||p||null!==_("COLORTERM")||(_("TERM")||"").includes("color"))}).call(this,n(1016))},468:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"c",(function(){return c})),n.d(e,"d",(function(){return a})),n.d(e,"e",(function(){return u})),n.d(e,"b",(function(){return d}));var r=n(3),i=n(8),s=n(417);const o=1,c=(t,e)=>{r.p(t,0);const n=s.encodeStateVector(e);r.q(t,n)},a=(t,e,n)=>{r.p(t,o),r.q(t,s.encodeStateAsUpdate(e,n))},l=(t,e,n)=>{try{s.applyUpdate(e,i.l(t),n)}catch(t){}},u=(t,e)=>{r.p(t,2),r.q(t,e)},h=l,d=(t,e,n,r)=>{const s=i.k(t);switch(s){case 0:((t,e,n)=>{a(e,n,i.l(t))})(t,e,n);break;case o:l(t,n,r);break;case 2:h(t,n,r);break;default:throw new Error("Unknown message type")}return s}},58:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return s}));const r=t=>new Error(t),i=()=>{throw r("Method unimplemented")},s=()=>{throw r("Unexpected case")}},73:function(t,e,n){"use strict";n.d(e,"e",(function(){return r})),n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"g",(function(){return o})),n.d(e,"b",(function(){return c})),n.d(e,"h",(function(){return a})),n.d(e,"d",(function(){return l})),n.d(e,"f",(function(){return u}));n(235);const r=t=>t[t.length-1],i=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},s=Array.from,o=(t,e)=>{for(let n=0;n<t.length;n++)if(e(t[n],n,t))return!0;return!1},c=(t,e)=>t.length===e.length&&((t,e)=>{for(let n=0;n<t.length;n++)if(!e(t[n],n,t))return!1;return!0})(t,(t,n)=>t===e[n]),a=(t,e)=>{const n=new Array(t);for(let r=0;r<t;r++)n[r]=e(r,n);return n},l=Array.isArray,u=(t,e)=>{const n=Array(t.length);for(let r=0;r<t.length;r++)n[r]=e(t[r],r,t);return n}},745:function(t,e,n){"use strict";(function(t){n.d(e,"b",(function(){return o})),n.d(e,"d",(function(){return c})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return l}));var r=n(174),i=n(467);n(73),n(27),n(3),n(8);const s=t=>new Uint8Array(t),o=t=>new Uint8Array(t),c=i.b?t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=r.d(t[n]);return btoa(e)}:e=>t.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),a=i.b?t=>{const e=atob(t),n=s(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}:e=>{const n=t.from(e,"base64");return r=n.buffer,i=n.byteOffset,s=n.byteLength,new Uint8Array(r,i,s);var r,i,s},l=t=>{const e=s(t.byteLength);return e.set(t),e}}).call(this,n(894).Buffer)},746:function(t,e,n){"use strict";n.d(e,"c",(function(){return s})),n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return c}));let r=new class{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}},i=!0;try{"undefined"!=typeof localStorage&&localStorage&&(r=localStorage,i=!1)}catch(t){}const s=r,o=t=>i||addEventListener("storage",t),c=t=>i||removeEventListener("storage",t)},785:function(t,e,n){"use strict";e.__esModule=!0;var r=n(441),i={NOTIFICATION_CONFLICT:"notificationConflict",NOTIFICATION_MAX_PAYLOAD:"notificationMaxPayload",UPDATE_HISTORY:"updateHistory",RESTORE:"restore",CLOSE:"close",DISCONNECTED:"disconnected",SYNC_DOCUMENT:"syncDocument"};Object.keys(i).forEach((function(t){return i[t]=r.PLUGIN_NAME+"."+i[t]})),e.default=i},786:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return o}));var r=n(27),i=n(18);const s=Number.MAX_SAFE_INTEGER,o=(Number.MIN_SAFE_INTEGER,i.i,i.j,Number.isInteger||(t=>"number"==typeof t&&isFinite(t)&&r.d(t)===t));Number.isNaN,Number.parseInt},8:function(t,e,n){"use strict";n.d(e,"e",(function(){return h})),n.d(e,"f",(function(){return d})),n.d(e,"l",(function(){return _})),n.d(e,"h",(function(){return g})),n.d(e,"k",(function(){return p})),n.d(e,"i",(function(){return y})),n.d(e,"j",(function(){return w})),n.d(e,"g",(function(){return b})),n.d(e,"b",(function(){return S})),n.d(e,"d",(function(){return v})),n.d(e,"a",(function(){return M})),n.d(e,"c",(function(){return k}));var r=n(18),i=n(27),s=n(786),o=n(174),c=n(58);n(3);const a=c.a("Unexpected end of array"),l=c.a("Integer out of Range");class u{constructor(t){this.arr=t,this.pos=0}}const h=t=>new u(t),d=t=>t.pos!==t.arr.length,f=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},_=t=>f(t,p(t)),g=t=>t.arr[t.pos++],p=t=>{let e=0,n=1;const i=t.arr.length;for(;t.pos<i;){const i=t.arr[t.pos++];if(e+=(i&r.m)*n,n*=128,i<r.g)return e;if(e>s.a)throw l}throw a},y=t=>{let e=t.arr[t.pos++],n=e&r.l,i=64;const o=(e&r.f)>0?-1:1;if(0==(e&r.g))return o*n;const c=t.arr.length;for(;t.pos<c;){if(e=t.arr[t.pos++],n+=(e&r.m)*i,i*=128,e<r.g)return o*n;if(n>s.a)throw l}throw a},w=o.f?t=>o.f.decode(_(t)):t=>{let e=p(t);if(0===e)return"";{let n=String.fromCodePoint(g(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(g(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},m=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},E=[t=>{},t=>null,y,t=>m(t,4).getFloat32(0,!1),t=>m(t,8).getFloat64(0,!1),t=>m(t,8).getBigInt64(0,!1),t=>!1,t=>!0,w,t=>{const e=p(t),n={};for(let r=0;r<e;r++){n[w(t)]=b(t)}return n},t=>{const e=p(t),n=[];for(let r=0;r<e;r++)n.push(b(t));return n},_],b=t=>E[127-g(t)](t);class S extends u{constructor(t,e){super(t),this.reader=e,this.s=null,this.count=0}read(){return 0===this.count&&(this.s=this.reader(this),d(this)?this.count=p(this)+1:this.count=-1),this.count--,this.s}}class v extends u{constructor(t){super(t),this.s=0,this.count=0}read(){if(0===this.count){this.s=y(this);const t=i.e(this.s);this.count=1,t&&(this.s=-this.s,this.count=p(this)+2)}return this.count--,this.s}}class M extends u{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){const t=y(this),e=1&t;this.diff=i.d(t/2),this.count=1,e&&(this.count=p(this)+2)}return this.s+=this.diff,this.count--,this.s}}class k{constructor(t){this.decoder=new v(t),this.str=w(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),e=this.str.slice(this.spos,t);return this.spos=t,e}}},89:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t){if(!window.SynapEditor)return;i.forEach((function(e){var n=Object.entries(t).reduce((function(t,n){var i=n[0],s=n[1];if(i){var o=s[e].split("|");t[i]=((r.isMac||r.isIOS)&&o[1]?o[1]:o[0]).trim()}return t}),{});window.SynapEditor.addMessages(e,n)}))};var r=n(12),i=["ko","en"]},894:function(t,e,n){"use strict";(function(t){var r=n(895),i=n(896),s=n(897);function o(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function c(t,e){if(o()<e)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=a.prototype:(null===t&&(t=new a(e)),t.length=e),t}function a(t,e,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return l(this,t,e,n)}function l(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);a.TYPED_ARRAY_SUPPORT?(t=e).__proto__=a.prototype:t=d(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|_(e,n),i=(t=c(t,r)).write(e,n);i!==r&&(t=t.slice(0,i));return t}(t,e,n):function(t,e){if(a.isBuffer(e)){var n=0|f(e.length);return 0===(t=c(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?c(t,0):d(t,e);if("Buffer"===e.type&&s(e.data))return d(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e){if(u(e),t=c(t,e<0?0:0|f(e)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function d(t,e){var n=e.length<0?0:0|f(e.length);t=c(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function f(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function _(t,e){if(a.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return F(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return H(t).length;default:if(r)return F(t).length;e=(""+e).toLowerCase(),r=!0}}function g(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return T(this,e,n);case"utf8":case"utf-8":return I(this,e,n);case"ascii":return A(this,e,n);case"latin1":case"binary":return C(this,e,n);case"base64":return k(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function p(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function y(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=a.from(e,r)),a.isBuffer(e))return 0===e.length?-1:w(t,e,n,r,i);if("number"==typeof e)return e&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):w(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function w(t,e,n,r,i){var s,o=1,c=t.length,a=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,c/=2,a/=2,n/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var u=-1;for(s=n;s<c;s++)if(l(t,s)===l(e,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===a)return u*o}else-1!==u&&(s-=s-u),u=-1}else for(n+a>c&&(n=c-a),s=n;s>=0;s--){for(var h=!0,d=0;d<a;d++)if(l(t,s+d)!==l(e,d)){h=!1;break}if(h)return s}return-1}function m(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var c=parseInt(e.substr(2*o,2),16);if(isNaN(c))return o;t[n+o]=c}return o}function E(t,e,n,r){return j(F(e,t.length-n),t,n,r)}function b(t,e,n,r){return j(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function S(t,e,n,r){return b(t,e,n,r)}function v(t,e,n,r){return j(H(e),t,n,r)}function M(t,e,n,r){return j(function(t,e){for(var n,r,i,s=[],o=0;o<t.length&&!((e-=2)<0);++o)n=t.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}(e,t.length-n),t,n,r)}function k(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function I(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var s,o,c,a,l=t[i],u=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h<=n)switch(h){case 1:l<128&&(u=l);break;case 2:128==(192&(s=t[i+1]))&&(a=(31&l)<<6|63&s)>127&&(u=a);break;case 3:s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&(a=(15&l)<<12|(63&s)<<6|63&o)>2047&&(a<55296||a>57343)&&(u=a);break;case 4:s=t[i+1],o=t[i+2],c=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&c)&&(a=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&c)>65535&&a<1114112&&(u=a)}null===u?(u=65533,h=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=h}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}e.Buffer=a,e.SlowBuffer=function(t){+t!=t&&(t=0);return a.alloc(+t)},e.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=o(),a.poolSize=8192,a._augment=function(t){return t.__proto__=a.prototype,t},a.from=function(t,e,n){return l(null,t,e,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(t,e,n){return function(t,e,n,r){return u(e),e<=0?c(t,e):void 0!==n?"string"==typeof r?c(t,e).fill(n,r):c(t,e).fill(n):c(t,e)}(null,t,e,n)},a.allocUnsafe=function(t){return h(null,t)},a.allocUnsafeSlow=function(t){return h(null,t)},a.isBuffer=function(t){return!(null==t||!t._isBuffer)},a.compare=function(t,e){if(!a.isBuffer(t)||!a.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,s=Math.min(n,r);i<s;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return a.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=a.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var o=t[n];if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},a.byteLength=_,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)p(this,e,e+1);return this},a.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)p(this,e,e+3),p(this,e+1,e+2);return this},a.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)p(this,e,e+7),p(this,e+1,e+6),p(this,e+2,e+5),p(this,e+3,e+4);return this},a.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?I(this,0,t):g.apply(this,arguments)},a.prototype.equals=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},a.prototype.compare=function(t,e,n,r,i){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(this===t)return 0;for(var s=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(e>>>=0),c=Math.min(s,o),l=this.slice(r,i),u=t.slice(e,n),h=0;h<c;++h)if(l[h]!==u[h]){s=l[h],o=u[h];break}return s<o?-1:o<s?1:0},a.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},a.prototype.indexOf=function(t,e,n){return y(this,t,e,n,!0)},a.prototype.lastIndexOf=function(t,e,n){return y(this,t,e,n,!1)},a.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return m(this,t,e,n);case"utf8":case"utf-8":return E(this,t,e,n);case"ascii":return b(this,t,e,n);case"latin1":case"binary":return S(this,t,e,n);case"base64":return v(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,e,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function A(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function C(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function T(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=e;s<n;++s)i+=Y(t[s]);return i}function D(t,e,n){for(var r=t.slice(e,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function O(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function U(t,e,n,r,i,s){if(!a.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function N(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,s=Math.min(t.length-n,2);i<s;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function R(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,s=Math.min(t.length-n,4);i<s;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function L(t,e,n,r,i,s){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function P(t,e,n,r,s){return s||L(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function B(t,e,n,r,s){return s||L(t,0,n,8),i.write(t,e,n,r,52,8),n+8}a.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),a.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=a.prototype;else{var i=e-t;n=new a(i,void 0);for(var s=0;s<i;++s)n[s]=this[s+t]}return n},a.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||O(t,e,this.length);for(var r=this[t],i=1,s=0;++s<e&&(i*=256);)r+=this[t+s]*i;return r},a.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||O(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},a.prototype.readUInt8=function(t,e){return e||O(t,1,this.length),this[t]},a.prototype.readUInt16LE=function(t,e){return e||O(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUInt16BE=function(t,e){return e||O(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUInt32LE=function(t,e){return e||O(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUInt32BE=function(t,e){return e||O(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||O(t,e,this.length);for(var r=this[t],i=1,s=0;++s<e&&(i*=256);)r+=this[t+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},a.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||O(t,e,this.length);for(var r=e,i=1,s=this[t+--r];r>0&&(i*=256);)s+=this[t+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},a.prototype.readInt8=function(t,e){return e||O(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},a.prototype.readInt16LE=function(t,e){e||O(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(t,e){e||O(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(t,e){return e||O(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return e||O(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readFloatLE=function(t,e){return e||O(t,4,this.length),i.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return e||O(t,4,this.length),i.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return e||O(t,8,this.length),i.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return e||O(t,8,this.length),i.read(this,t,!1,52,8)},a.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||U(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,s=0;for(this[e]=255&t;++s<n&&(i*=256);)this[e+s]=t/i&255;return e+n},a.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||U(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+n},a.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||U(this,t,e,1,255,0),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},a.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||U(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):N(this,t,e,!0),e+2},a.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||U(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):N(this,t,e,!1),e+2},a.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||U(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):R(this,t,e,!0),e+4},a.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||U(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):R(this,t,e,!1),e+4},a.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);U(this,t,e,n,i-1,-i)}var s=0,o=1,c=0;for(this[e]=255&t;++s<n&&(o*=256);)t<0&&0===c&&0!==this[e+s-1]&&(c=1),this[e+s]=(t/o>>0)-c&255;return e+n},a.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);U(this,t,e,n,i-1,-i)}var s=n-1,o=1,c=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===c&&0!==this[e+s+1]&&(c=1),this[e+s]=(t/o>>0)-c&255;return e+n},a.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||U(this,t,e,1,127,-128),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||U(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):N(this,t,e,!0),e+2},a.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||U(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):N(this,t,e,!1),e+2},a.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||U(this,t,e,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):R(this,t,e,!0),e+4},a.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||U(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):R(this,t,e,!1),e+4},a.prototype.writeFloatLE=function(t,e,n){return P(this,t,e,!0,n)},a.prototype.writeFloatBE=function(t,e,n){return P(this,t,e,!1,n)},a.prototype.writeDoubleLE=function(t,e,n){return B(this,t,e,!0,n)},a.prototype.writeDoubleBE=function(t,e,n){return B(this,t,e,!1,n)},a.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,s=r-n;if(this===t&&n<e&&e<r)for(i=s-1;i>=0;--i)t[i+e]=this[i+n];else if(s<1e3||!a.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+s),e);return s},a.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var s;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(s=e;s<n;++s)this[s]=t;else{var o=a.isBuffer(t)?t:F(new a(t,r).toString()),c=o.length;for(s=0;s<n-e;++s)this[s+e]=o[s%c]}return this};var x=/[^+\/0-9A-Za-z-_]/g;function Y(t){return t<16?"0"+t.toString(16):t.toString(16)}function F(t,e){var n;e=e||1/0;for(var r=t.length,i=null,s=[],o=0;o<r;++o){if((n=t.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function H(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(x,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function j(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(36))},895:function(t,e,n){"use strict";e.byteLength=function(t){var e=l(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,n,r=l(t),o=r[0],c=r[1],a=new s(function(t,e,n){return 3*(e+n)/4-n}(0,o,c)),u=0,h=c>0?o-4:o;for(n=0;n<h;n+=4)e=i[t.charCodeAt(n)]<<18|i[t.charCodeAt(n+1)]<<12|i[t.charCodeAt(n+2)]<<6|i[t.charCodeAt(n+3)],a[u++]=e>>16&255,a[u++]=e>>8&255,a[u++]=255&e;2===c&&(e=i[t.charCodeAt(n)]<<2|i[t.charCodeAt(n+1)]>>4,a[u++]=255&e);1===c&&(e=i[t.charCodeAt(n)]<<10|i[t.charCodeAt(n+1)]<<4|i[t.charCodeAt(n+2)]>>2,a[u++]=e>>8&255,a[u++]=255&e);return a},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,s=[],o=0,c=n-i;o<c;o+=16383)s.push(u(t,o,o+16383>c?c:o+16383));1===i?(e=t[n-1],s.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],s.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return s.join("")};for(var r=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,a=o.length;c<a;++c)r[c]=o[c],i[o.charCodeAt(c)]=c;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function u(t,e,n){for(var i,s,o=[],c=e;c<n;c+=3)i=(t[c]<<16&16711680)+(t[c+1]<<8&65280)+(255&t[c+2]),o.push(r[(s=i)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},896:function(t,e){e.read=function(t,e,n,r,i){var s,o,c=8*i-r-1,a=(1<<c)-1,l=a>>1,u=-7,h=n?i-1:0,d=n?-1:1,f=t[e+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=c;u>0;s=256*s+t[e+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+t[e+h],h+=d,u-=8);if(0===s)s=1-l;else{if(s===a)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=l}return(f?-1:1)*o*Math.pow(2,s-r)},e.write=function(t,e,n,r,i,s){var o,c,a,l=8*s-i-1,u=(1<<l)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,_=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-o))<1&&(o--,a*=2),(e+=o+h>=1?d/a:d*Math.pow(2,1-h))*a>=2&&(o++,a/=2),o+h>=u?(c=0,o=u):o+h>=1?(c=(e*a-1)*Math.pow(2,i),o+=h):(c=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[n+f]=255&c,f+=_,c/=256,i-=8);for(o=o<<i|c,l+=i;l>0;t[n+f]=255&o,f+=_,o/=256,l-=8);t[n+f-_]|=128*g}},897:function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},916:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=t=>void 0===t?null:t}})}));